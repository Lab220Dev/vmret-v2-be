import{H as P}from"./vue-datepicker-d4babe2b.js";import{r as s,e as ie,m as de,s as ce,g as c,o as b,c as j,d as n,h as t,y as R,a as S,w as u,z,F as ue,l as f,i as H,t as A,A as pe}from"./index-2c4d9b34.js";/* empty css             */import{L as ve}from"./LoadingSpinner-e33360a4.js";import"./format-7e97a1d1.js";const me={class:"card vh"},fe={class:"form"},_e={class:"grid mt-3 mx-1 px-1"},he=n("h5",{class:"my-4 text-2xl"},"Devoluções",-1),be={key:0,class:"p-0 m-0 p-fluid formgrid grid col-12"},ye={class:"field xl:col-3 lg:col-6 md:col-6 sm:col-6"},we=n("label",{for:"dm"},"DM:",-1),ge={class:"field xl:col-3 lg:col-6 md:col-6 sm:col-6"},Ve=n("label",{for:"planta"},"Planta:",-1),Ce={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},De=n("label",{for:"perfil"},"Centro de Custo:",-1),ke={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},xe=n("label",{for:"perfil"},"Setor:",-1),Ie={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Se=n("label",{for:"perfil"},"Funcionário:",-1),Ae={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Oe=n("label",{for:"perfil"},"Data Inicial:",-1),Be={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Fe=n("label",{for:"perfil"},"Data Final:",-1),$e={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Me={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Ue={class:"field xl:col-3 lg:col-4 md:col-6 sm:col-6"},Ne={class:"datatable-wrapper"},Te={class:"flex justify-content-end"},Ee=n("i",{class:"pi pi-search"},null,-1),Je={__name:"devolucoes",setup(Le){const y=s(!1),O=s(""),d=ie();de();const w=s(null),g=s(null),V=s(null),C=s(null),D=s(null),m=s([]),p={label:"Todos",value:null},B=s(null),F=s([p]),$=s([p]),M=s([p]),U=s([p]),_=s({global:{value:null,matchMode:pe.CONTAINS}}),k=s("Ainda não foi feita nenhuma busca"),x=s(!0),N=s([]),I=s(!1),a=s({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),T=l=>{const e=l.getDate(),o=l.getMonth()+1,i=l.getFullYear();return`${e}/${o}/${i}`},E=l=>l?new Date(l).toISOString():null,J=async()=>{const l={id_cliente:d.userIdCliente,id_dm:a.value.dm===null?void 0:a.value.dm,id_planta:a.value.id_planta===null?void 0:a.value.id_planta,id_centro_custo:a.value.id_centro_custo===null?void 0:a.value.id_centro_custo,id_setor:a.value.id_setor===null?void 0:a.value.id_setor,id_funcionario:a.value.id_funcionario===null?void 0:a.value.id_funcionario,data_inicio:E(a.value.data_inicio),data_final:E(a.value.data_final)};try{I.value=!0;const e=await f.post("relatorioRetiRe/relatorio",l,{headers:{Authorization:`Bearer ${d.token}`}});m.value=e.data,Array.isArray(m.value)&&m.value.length===0&&(O.value="Nenhum dado encontrado. Por favor, verifique sua consulta.",y.value=!0),m.value.length===0?k.value="Nenhum dado encontrado. Por favor, verifique sua consulta.":k.value=""}catch(e){console.error("Erro ao buscar devoluções:",e)}finally{I.value=!1}},K=()=>{x.value=!0,N.value={}},Q=s(null),q=l=>{const e=Object.keys(l[0]).join(","),o=l.map(i=>Object.values(i).join(",")).join(`
`);return`${e}
${o}`},Y=()=>{const l=q(m.value),e=new Blob([l],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),i=URL.createObjectURL(e);o.setAttribute("href",i),o.setAttribute("download","Devoluções.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},G=()=>{const l=JSON.stringify(m.value,null,2),e=new Blob([l],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),i=URL.createObjectURL(e);o.setAttribute("href",i),o.setAttribute("download","Devoluções.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},W=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await f.get("/relatorioRetiRe/listardm",{params:l,headers:{Authorization:`Bearer ${d.token}`}});F.value=[p,...e.data.map(({id_dm:o})=>({label:`DM  ${o}`,value:o}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},X=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await f.post("funcionarios/listarplanta",l,{headers:{Authorization:`Bearer ${d.token}`}});$.value=[p,...e.data.map(({id_planta:o})=>({label:`Planta  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},Z=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await f.post("funcionarios/listarsetor",l,{headers:{Authorization:`Bearer ${d.token}`}});M.value=[p,...e.data.map(({id_setor:o})=>({label:`Setor  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},ee=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await f.post("funcionarios/listarcentrocusto",l,{headers:{Authorization:`Bearer ${d.token}`}});U.value=[p,...e.data.map(({id_centro_custo:o})=>({label:`Centro de Custo  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},oe=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await f.post("/funcionarios/listar",l,{headers:{Authorization:`Bearer ${d.token}`}});B.value=e.data.map(o=>({label:o.nome,value:o.id_funcionario}))}catch(e){console.error("Erro ao carregar usuários:",e)}},le=()=>{var l,e,o,i,h;(l=w.value)!=null&&l.overlayVisible&&w.value.hide(),(e=g.value)!=null&&e.overlayVisible&&g.value.hide(),(o=V.value)!=null&&o.overlayVisible&&V.value.hide(),(i=C.value)!=null&&i.overlayVisible&&C.value.hide(),(h=D.value)!=null&&h.overlayVisible&&D.value.hide()},L=()=>{le()};return ce(()=>{W(),X(),Z(),oe(),ee()}),(l,e)=>{const o=c("Dropdown"),i=c("Button"),h=c("InputIcon"),ae=c("InputText"),te=c("IconField"),v=c("Column"),ne=c("DataTable"),se=c("Card"),re=c("Dialog");return b(),j(ue,null,[n("div",me,[n("div",fe,[n("div",_e,[he,x.value?(b(),j("div",be,[n("div",ye,[we,t(o,{class:"drop",modelValue:a.value.dm,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.dm=r),options:F.value,optionLabel:"label",optionValue:"value",ref_key:"dropdown1",ref:w,placeholder:"Todos"},null,8,["modelValue","options"])]),n("div",ge,[Ve,t(o,{class:"drop",modelValue:a.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.id_planta=r),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:g},null,8,["modelValue","options"])]),n("div",Ce,[De,t(o,{class:"drop",modelValue:a.value.id_centro_custo,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.id_centro_custo=r),options:U.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:V},null,8,["modelValue","options"])]),n("div",ke,[xe,t(o,{class:"drop",modelValue:a.value.id_setor,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.id_setor=r),options:M.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:C},null,8,["modelValue","options"])]),n("div",Ie,[Se,t(o,{class:"drop",modelValue:a.value.id_funcionario,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.id_funcionario=r),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:D},null,8,["modelValue","options"])]),n("div",Ae,[Oe,t(R(P),{class:"drop",modelValue:a.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.data_inicio=r),showIcon:"",showOnFocus:!1,format:T,locale:"pt-BR","auto-apply":"","enable-time-picker":!1,placeholder:"Selecione uma data inicial",teleport:"body",ref:"datepicker1",onOpen:L},null,8,["modelValue"])]),n("div",Be,[Fe,t(R(P),{class:"drop",modelValue:a.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.data_final=r),showIcon:"",showOnFocus:!1,format:T,locale:"pt-BR","auto-apply":"","enable-time-picker":!1,placeholder:"Selecione uma data final",teleport:"body",ref:"datepicker2",onOpen:L},null,8,["modelValue"])]),n("div",$e,[t(i,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:J})]),n("div",Me,[t(i,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Y})]),n("div",Ue,[t(i,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:G})])])):S("",!0),n("div",Ne,[t(ne,{filters:_.value,"onUpdate:filters":e[8]||(e[8]=r=>_.value=r),value:m.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",globalFilterFields:["ID_DM","Dia","matricula","nome","email","ProdutoNome","Quantidade","ProdutoSKU"],tableStyle:{width:"100%"},ref_key:"dt",ref:Q,class:""},{header:u(()=>[n("div",Te,[t(te,{iconPosition:"left"},{default:u(()=>[t(h,null,{default:u(()=>[Ee]),_:1}),t(ae,{modelValue:_.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=r=>_.value.global.value=r),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:u(()=>[H(A(k.value),1)]),default:u(()=>[t(v,{field:"ID_DM",sortable:"",header:"DM"}),t(v,{field:"Dia",sortable:"",header:"Data"}),t(v,{field:"matricula",sortable:"",header:"Matricula"}),t(v,{field:"nome",sortable:"",header:"Nome"}),t(v,{field:"email",sortable:"",header:"E-mail"}),t(v,{field:"ProdutoNome",sortable:"",header:"Item"}),t(v,{field:"Quantidade",sortable:"",header:"Quant",class:"text-center"}),t(v,{field:"ProdutoSKU",sortable:"",header:"CA"})]),_:1},8,["filters","value"])]),x.value?S("",!0):(b(),z(se,{key:1},{title:u(()=>[H(A(N.value.dm),1)]),content:u(()=>[t(i,{type:"button",label:"Voltar",icon:"pi pi-arrow-left",severity:"info",onClick:K})]),_:1}))])])]),I.value?(b(),z(ve,{key:0})):S("",!0),t(re,{header:"Informação",visible:y.value,style:{width:"30vw"},modal:!0,closable:!1},{footer:u(()=>[t(i,{label:"OK",icon:"pi pi-check",onClick:e[9]||(e[9]=r=>y.value=!1)})]),default:u(()=>[n("p",null,A(O.value),1)]),_:1},8,["visible"])],64)}}};export{Je as default};
