import{H as v}from"./vue-datepicker-6e00734e.js";/* empty css             */import{e as M,r as i,s as A,l as O,g as p,o as b,c as B,d as l,h as s,y,w as S,z as j,a as R,F}from"./index-9455c001.js";import{L as I}from"./LoadingSpinner-cd745a8e.js";import"./format-7e97a1d1.js";const L={class:"card vh"},U={class:"form"},$={class:"grid mt-3 mx-1 px-1"},E=l("h5",{class:"my-4 text-2xl"},"Metricas da DM",-1),N={class:"p-0 m-0 p-fluid formgrid grid col-12"},z={class:"field lg:col-4 md:col-6 sm:col-6"},H=l("label",{for:"dm"},"DM:",-1),J={class:"field lg:col-4 md:col-6 sm:col-6"},T=l("label",{for:"perfil"},"Data Inicial:",-1),Y={class:"field lg:col-4 md:col-6 sm:col-6"},q=l("label",{for:"perfil"},"Data Final:",-1),G={class:"field lg:col-4 md:col-6 sm:col-6"},P={class:"field lg:col-4 md:col-6 sm:col-6"},Q={class:"field lg:col-4 md:col-6 sm:col-6"},K={class:"datatable-wrapper"},ae={__name:"MetricasDM",setup(W){const _=M(),n=i({id_DM:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),d=i([]),w=i([]),m=i(null);A(()=>{D()});const D=async()=>{const e={id_cliente:_.userIdCliente};try{d=(await O.post("relatorios/listarDms",e,{headers:{Authorization:`Bearer ${_.token}`}})).data,w.value=d.map(t=>({label:t.nome,value:t.id_maquina}))}catch(o){console.error("Erro ao buscar centros de custo:",o)}},f=e=>{const o=e.getDate(),t=e.getMonth()+1,a=e.getFullYear();return`${o}/${t}/${a}`},g=i(null),k=e=>{const o=Object.keys(e[0]).join(","),t=e.map(a=>Object.values(a).join(",")).join(`
`);return`${o}
${t}`},C=()=>{if(Array.isArray(retiradas.value)){const e=retiradas.value.flatMap(r=>Array.isArray(r.Detalhes)?r.Detalhes:(console.warn(`Detalhes não é um array para o produto ${r.ProdutoID}`),[])),o=k(e),t=new Blob([o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),u=URL.createObjectURL(t);a.setAttribute("href",u),a.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("retiradas.value não é um array.")},V=()=>{const e=JSON.stringify(retiradas.value,null,2),o=new Blob([e],{type:"application/json;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(o);t.setAttribute("href",a),t.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},x=()=>{var e;(e=m.value)!=null&&e.overlayVisible&&m.value.hide()},h=()=>{x()};return(e,o)=>{const t=p("Dropdown"),a=p("Button"),u=p("Column"),r=p("DataTable");return b(),B(F,null,[l("div",L,[l("div",U,[l("div",$,[E,l("div",N,[l("div",z,[H,s(t,{class:"drop",modelValue:n.value.dm,"onUpdate:modelValue":o[0]||(o[0]=c=>n.value.dm=c),options:d.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:m},null,8,["modelValue","options"])]),l("div",J,[T,s(y(v),{class:"drop",modelValue:n.value.data_inicio,"onUpdate:modelValue":o[1]||(o[1]=c=>n.value.data_inicio=c),showIcon:"",showOnFocus:!1,format:f,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:h,placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),l("div",Y,[q,s(y(v),{class:"drop",modelValue:n.value.data_final,"onUpdate:modelValue":o[2]||(o[2]=c=>n.value.data_final=c),showIcon:"",showOnFocus:!1,format:f,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:h,placeholder:"Selecione uma data final"},null,8,["modelValue"])]),l("div",G,[s(a,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:e.buscar},null,8,["onClick"])]),l("div",P,[s(a,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:C})]),l("div",Q,[s(a,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:V})])]),l("div",K,[s(r,{value:d.value,stripedRows:"",showGridlines:"",rowHover:"",tableStyle:{width:"100%"},ref_key:"dt",ref:g},{default:S(()=>[s(u,{field:"total",sortable:"",header:"Item"}),s(u,{field:"total",sortable:"",header:"Quantidade",class:"text-center"})]),_:1},8,["value"])])])])]),e.loading?(b(),j(I,{key:0})):R("",!0)],64)}}};export{ae as default};
