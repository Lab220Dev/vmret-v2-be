import{H as L}from"./vue-datepicker-6e00734e.js";import{r as n,e as re,m as ie,s as de,g as u,o as S,c as ce,d as t,h as s,y as j,w as c,z as E,a as z,F as ue,B as pe,l as _,i as K,t as q,A as me}from"./index-9455c001.js";/* empty css             */import{L as ve}from"./LoadingSpinner-cd745a8e.js";import"./format-7e97a1d1.js";const fe={class:"card vh"},_e={class:"form"},he={class:"grid mt-3 mx-1 px-1"},be=t("h5",{class:"my-4 text-2xl"},"Itens mais retirados",-1),ye={class:"p-0 m-0 p-fluid formgrid grid col-12"},we={class:"field lg:col-4 md:col-6 sm:col-6"},ge=t("label",{for:"dm"},"DM:",-1),Ve={class:"field lg:col-4 md:col-6 sm:col-6"},Ce=t("label",{for:"planta"},"Planta:",-1),Ie={class:"field lg:col-4 md:col-6 sm:col-6"},ke=t("label",{for:"perfil"},"Centro de Custo:",-1),De={class:"field lg:col-6 md:col-6 sm:col-6"},Se=t("label",{for:"perfil"},"Setor:",-1),Ae={class:"field xl:col-6 lg:col-6 md:col-6 sm:col-6"},xe=t("label",{for:"perfil"},"Funcionário:",-1),Oe={class:"field lg:col-4 md:col-6 sm:col-6"},Pe=t("label",{for:"perfil"},"Data Inicial:",-1),Be={class:"field lg:col-4 md:col-6 sm:col-6"},Ue=t("label",{for:"perfil"},"Data Final:",-1),$e={class:"field lg:col-4 md:col-6 sm:col-6"},Fe={class:"field lg:col-4 md:col-6 sm:col-6"},Me={class:"field lg:col-4 md:col-6 sm:col-6"},Ne={class:"datatable-wrapper"},Te={class:"flex justify-content-end"},Re=t("i",{class:"pi pi-search"},null,-1),He={__name:"itemsmaisretirados",setup(Le){const y=n(!1),A=n(""),d=re();ie();const w=n("Ainda não foi feita nenhuma busca"),g=n(null),V=n(null),C=n(null),I=n(null),k=n(null),p=n([]),m={label:"Todos",value:null},x=n(null),O=n([m]),P=n([m]),B=n([m]),U=n([m]),b=n({global:{value:null,matchMode:me.CONTAINS}}),$=n(!1),F=n([]),D=n(!1),l=n({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),M=a=>{const e=a.getDate(),o=a.getMonth()+1,r=a.getFullYear();return`${e}/${o}/${r}`},N=a=>a?new Date(a).toISOString():null,H=async()=>{const a={id_cliente:d.userIdCliente,id_dm:l.value.dm===null?void 0:l.value.dm,id_planta:l.value.id_planta===null?void 0:l.value.id_planta,id_centro_custo:l.value.id_centro_custo===null?void 0:l.value.id_centro_custo,id_setor:l.value.id_setor===null?void 0:l.value.id_setor,id_funcionario:l.value.id_funcionario===null?void 0:l.value.id_funcionario,data_inicio:N(l.value.data_inicio),data_final:N(l.value.data_final)};try{D.value=!0;const e=await _.post("relatorioItems/relatorio",a,{headers:{Authorization:`Bearer ${d.token}`}});p.value=e.data,p.value.length===0?w.value="Nenhum dado encontrado. Por favor, verifique sua consulta.":w.value="",Array.isArray(p.value)&&p.value.length===0&&(A.value="Nenhum dado encontrado. Por favor, verifique sua consulta.",y.value=!0)}catch(e){console.error("Erro ao buscar centros de custo:",e)}finally{D.value=!1}},Q=a=>{$.value=!0,F.value=a.data.Detalhes,pe(()=>{const e=document.querySelector(".details-card");e&&e.scrollIntoView({behavior:"smooth"})})},J=n(null),G=a=>{const e=Object.keys(a[0]).join(","),o=a.map(r=>Object.values(r).join(",")).join(`
`);return`${e}
${o}`},Y=()=>{if(Array.isArray(p.value)){const a=p.value.flatMap(h=>Array.isArray(h.Detalhes)?h.Detalhes:(console.warn(`Detalhes não é um array para o produto ${h.ProdutoID}`),[])),e=G(a),o=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),f=URL.createObjectURL(o);r.setAttribute("href",f),r.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else console.error("retiradas.value não é um array.")},W=()=>{const a=JSON.stringify(p.value,null,2),e=new Blob([a],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),r=URL.createObjectURL(e);o.setAttribute("href",r),o.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},X=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await _.post("/relatorioItems/listardm",a,{headers:{Authorization:`Bearer ${d.token}`}});O.value=[m,...e.data.map(({id_dm:o})=>({label:`DM  ${o}`,value:o}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},Z=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await _.post("relatorioItems/listarPlanta",a,{headers:{Authorization:`Bearer ${d.token}`}});P.value=[m,...e.data.map(({id_planta:o})=>({label:`Planta  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},ee=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await _.post("relatorioItems/listarSetor",a,{headers:{Authorization:`Bearer ${d.token}`}});B.value=[m,...e.data.map(({id_setor:o})=>({label:`Setor  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},oe=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await _.post("relatorioItems/listarCdC",a,{headers:{Authorization:`Bearer ${d.token}`}});U.value=[m,...e.data.map(({id_centro_custo:o})=>({label:`Centro de Custo  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},ae=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await _.post("/funcionarios/listar",a,{headers:{Authorization:`Bearer ${d.token}`}});x.value=e.data.map(o=>({label:o.nome,value:o.id_funcionario}))}catch(e){console.error("Erro ao carregar usuários:",e)}},le=()=>{var a,e,o,r,f;(a=g.value)!=null&&a.overlayVisible&&g.value.hide(),(e=V.value)!=null&&e.overlayVisible&&V.value.hide(),(o=C.value)!=null&&o.overlayVisible&&C.value.hide(),(r=I.value)!=null&&r.overlayVisible&&I.value.hide(),(f=k.value)!=null&&f.overlayVisible&&k.value.hide()},T=()=>{le()};return de(()=>{X(),Z(),ee(),ae(),oe()}),(a,e)=>{const o=u("Dropdown"),r=u("Button"),f=u("InputIcon"),h=u("InputText"),te=u("IconField"),v=u("Column"),R=u("DataTable"),se=u("card"),ne=u("Dialog");return S(),ce(ue,null,[t("div",fe,[t("div",_e,[t("div",he,[be,t("div",ye,[t("div",we,[ge,s(o,{class:"drop",modelValue:l.value.dm,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.dm=i),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:g},null,8,["modelValue","options"])]),t("div",Ve,[Ce,s(o,{class:"drop",modelValue:l.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.id_planta=i),options:P.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:V},null,8,["modelValue","options"])]),t("div",Ie,[ke,s(o,{class:"drop",modelValue:l.value.id_centro_custo,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.id_centro_custo=i),options:U.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:C},null,8,["modelValue","options"])]),t("div",De,[Se,s(o,{class:"drop",modelValue:l.value.id_setor,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.id_setor=i),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:I},null,8,["modelValue","options"])]),t("div",Ae,[xe,s(o,{class:"drop",modelValue:l.value.id_funcionario,"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.id_funcionario=i),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:k},null,8,["modelValue","options"])]),t("div",Oe,[Pe,s(j(L),{class:"drop",modelValue:l.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=i=>l.value.data_inicio=i),showIcon:"",showOnFocus:!1,format:M,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:T,teleport:"body",placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),t("div",Be,[Ue,s(j(L),{class:"drop",modelValue:l.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=i=>l.value.data_final=i),showIcon:"",showOnFocus:!1,format:M,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:T,teleport:"body",placeholder:"Selecione uma data final"},null,8,["modelValue"])]),t("div",$e,[s(r,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:H})]),t("div",Fe,[s(r,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Y})]),t("div",Me,[s(r,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:W})])]),t("div",Ne,[s(R,{filters:b.value,"onUpdate:filters":e[8]||(e[8]=i=>b.value=i),value:p.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",onRowSelect:Q,globalFilterFields:["ProdutoNome","Quantidade","ProdutoSKU"],selectionMode:"single",tableStyle:{width:"100%"},ref_key:"dt",ref:J},{header:c(()=>[t("div",Te,[s(te,{iconPosition:"left"},{default:c(()=>[s(f,null,{default:c(()=>[Re]),_:1}),s(h,{modelValue:b.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=i=>b.value.global.value=i),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:c(()=>[K(q(w.value),1)]),default:c(()=>[s(v,{field:"ProdutoNome",sortable:"",header:"Item"}),s(v,{field:"quantidade_no_periodo",sortable:"",header:"Quantidade",class:"text-center"}),s(v,{field:"ProdutoSKU",sortable:"",header:"CA"})]),_:1},8,["filters","value"]),$.value?(S(),E(se,{key:0,class:"details-card"},{title:c(()=>[K("Detalhes do Produto")]),content:c(()=>[s(R,{value:F.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:""},{default:c(()=>[s(v,{field:"ProdutoNome",sortable:"",header:"Item"}),s(v,{field:"Data",sortable:"",header:"Data"}),s(v,{field:"Quantidade",sortable:"",header:"Quantidade"}),s(v,{field:"ProdutoSKU",sortable:"",header:"SKU"})]),_:1},8,["value"])]),_:1})):z("",!0)])])])]),D.value?(S(),E(ve,{key:0})):z("",!0),s(ne,{header:"Informação",visible:y.value,style:{width:"30vw"},modal:!0,closable:!1},{footer:c(()=>[s(r,{label:"OK",icon:"pi pi-check",onClick:e[9]||(e[9]=i=>y.value=!1)})]),default:c(()=>[t("p",null,q(A.value),1)]),_:1},8,["visible"])],64)}}};export{He as default};
