import{H as L}from"./vue-datepicker-586ac984.js";import{r,e as re,m as ie,s as de,g as p,o as S,c as ce,d as s,h as n,y as j,w as c,z as E,a as z,F as ue,B as pe,l as _,i as K,t as q,A as me}from"./index-049900ab.js";/* empty css             */import{L as ve}from"./LoadingSpinner-fcf5a171.js";import"./format-7e97a1d1.js";/* empty css                                                       */const fe={class:"card vh"},_e={class:"form"},he={class:"grid mt-3 mx-1 px-1"},be=s("h5",{class:"my-4 text-2xl"},"Itens mais retirados",-1),ye={class:"p-0 m-0 p-fluid formgrid grid col-12"},we={class:"field lg:col-4 md:col-6 sm:col-6"},ge=s("label",{for:"dm"},"DM:",-1),Ve={class:"field lg:col-4 md:col-6 sm:col-6"},Ce=s("label",{for:"planta"},"Planta:",-1),ke={class:"field lg:col-4 md:col-6 sm:col-6"},De=s("label",{for:"perfil"},"Centro de Custo:",-1),Ie={class:"field lg:col-6 md:col-6 sm:col-6"},Se=s("label",{for:"perfil"},"Setor:",-1),Ae={class:"field xl:col-6 lg:col-6 md:col-6 sm:col-6"},xe=s("label",{for:"perfil"},"Funcionário:",-1),Oe={class:"field lg:col-4 md:col-6 sm:col-6"},Be=s("label",{for:"perfil"},"Data Inicial:",-1),Pe={class:"field lg:col-4 md:col-6 sm:col-6"},Ue=s("label",{for:"perfil"},"Data Final:",-1),$e={class:"field lg:col-4 md:col-6 sm:col-6"},Fe={class:"field lg:col-4 md:col-6 sm:col-6"},Me={class:"field lg:col-4 md:col-6 sm:col-6"},Ne={class:"datatable-wrapper"},Te={class:"flex justify-content-end"},Re=s("i",{class:"pi pi-search"},null,-1),Qe={__name:"itemsmaisretirados",setup(Le){const y=r(!1),A=r(""),d=re();ie();const w=r("Ainda não foi feita nenhuma busca"),g=r(null),V=r(null),C=r(null),k=r(null),D=r(null),m=r([]),u={label:"Todos",value:null},x=r(null),O=r([u]),B=r([u]),P=r([u]),U=r([u]),b=r({global:{value:null,matchMode:me.CONTAINS}}),$=r(!1),F=r([]),I=r(!1),t=r({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),M=o=>{const e=o.getDate(),a=o.getMonth()+1,l=o.getFullYear();return`${e}/${a}/${l}`},N=o=>o?new Date(o).toISOString():null,H=async()=>{const o={id_cliente:d.userIdCliente,id_dm:t.value.dm===null?void 0:t.value.dm,id_planta:t.value.id_planta===null?void 0:t.value.id_planta,id_centro_custo:t.value.id_centro_custo===null?void 0:t.value.id_centro_custo,id_setor:t.value.id_setor===null?void 0:t.value.id_setor,id_funcionario:t.value.id_funcionario===null?void 0:t.value.id_funcionario,data_inicio:N(t.value.data_inicio),data_final:N(t.value.data_final)};try{I.value=!0;const e=await _.post("relatorioItems/relatorio",o,{headers:{Authorization:`Bearer ${d.token}`}});m.value=e.data,m.value.length===0?w.value="Nenhum dado encontrado. Por favor, verifique sua consulta.":w.value="",Array.isArray(m.value)&&m.value.length===0&&(A.value="Nenhum dado encontrado. Por favor, verifique sua consulta.",y.value=!0)}catch(e){console.error("Erro ao buscar centros de custo:",e)}finally{I.value=!1}},Q=o=>{$.value=!0,F.value=o.data.Detalhes,pe(()=>{const e=document.querySelector(".details-card");e&&e.scrollIntoView({behavior:"smooth"})})},J=r(null),G=o=>{const e=Object.keys(o[0]).join(","),a=o.map(l=>Object.values(l).join(",")).join(`
`);return`${e}
${a}`},Y=()=>{if(Array.isArray(m.value)){const o=m.value.flatMap(h=>Array.isArray(h.Detalhes)?h.Detalhes:(console.warn(`Detalhes não é um array para o produto ${h.ProdutoID}`),[])),e=G(o),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),f=URL.createObjectURL(a);l.setAttribute("href",f),l.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}else console.error("retiradas.value não é um array.")},W=()=>{const o=JSON.stringify(m.value,null,2),e=new Blob([o],{type:"application/json;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(e);a.setAttribute("href",l),a.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},X=async()=>{const o={id_cliente:d.userIdCliente};try{const e=await _.post("/relatorioItems/listardm",o,{headers:{Authorization:`Bearer ${d.token}`}});O.value=[u,...e.data.map(({ID_DM:a,Identificacao:l})=>({label:`DM  ${l}`,value:a}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},Z=async()=>{const o={id_cliente:d.userIdCliente};try{const e=await _.post("plantas/listar",o,{headers:{Authorization:`Bearer ${d.token}`}});B.value=[u,...e.data.map(({nome:a,id_planta:l})=>({label:`Planta  ${a}`,value:l}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},ee=async()=>{const o={id_cliente:d.userIdCliente};try{const e=await _.post("Setor/listar",o,{headers:{Authorization:`Bearer ${d.token}`}});P.value=[u,...e.data.map(({id_setor:a,nome:l})=>({label:`Setor  ${l}`,value:a}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},oe=async()=>{const o={id_cliente:d.userIdCliente};try{const e=await _.post("cdc/listar",o,{headers:{Authorization:`Bearer ${d.token}`}});U.value=[u,...e.data.map(({ID_CentroCusto:a,Nome:l})=>({label:`Centro de Custo  ${l}`,value:a}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},ae=async()=>{const o={id_cliente:d.userIdCliente};try{const e=await _.post("/funcionarios/listar",o,{headers:{Authorization:`Bearer ${d.token}`}});x.value=[u,...e.data.map(a=>({label:a.nome,value:a.id_funcionario}))]}catch(e){console.error("Erro ao carregar usuários:",e)}},le=()=>{var o,e,a,l,f;(o=g.value)!=null&&o.overlayVisible&&g.value.hide(),(e=V.value)!=null&&e.overlayVisible&&V.value.hide(),(a=C.value)!=null&&a.overlayVisible&&C.value.hide(),(l=k.value)!=null&&l.overlayVisible&&k.value.hide(),(f=D.value)!=null&&f.overlayVisible&&D.value.hide()},T=()=>{le()};return de(()=>{X(),Z(),ee(),ae(),oe()}),(o,e)=>{const a=p("Dropdown"),l=p("Button"),f=p("InputIcon"),h=p("InputText"),te=p("IconField"),v=p("Column"),R=p("DataTable"),se=p("card"),ne=p("Dialog");return S(),ce(ue,null,[s("div",fe,[s("div",_e,[s("div",he,[be,s("div",ye,[s("div",we,[ge,n(a,{class:"drop",modelValue:t.value.dm,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.dm=i),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:g},null,8,["modelValue","options"])]),s("div",Ve,[Ce,n(a,{class:"drop",modelValue:t.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.id_planta=i),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:V},null,8,["modelValue","options"])]),s("div",ke,[De,n(a,{class:"drop",modelValue:t.value.id_centro_custo,"onUpdate:modelValue":e[2]||(e[2]=i=>t.value.id_centro_custo=i),options:U.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:C},null,8,["modelValue","options"])]),s("div",Ie,[Se,n(a,{class:"drop",modelValue:t.value.id_setor,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.id_setor=i),options:P.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:k},null,8,["modelValue","options"])]),s("div",Ae,[xe,n(a,{class:"drop",modelValue:t.value.id_funcionario,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.id_funcionario=i),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:D},null,8,["modelValue","options"])]),s("div",Oe,[Be,n(j(L),{class:"drop",modelValue:t.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=i=>t.value.data_inicio=i),showIcon:"",showOnFocus:!1,format:M,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:T,teleport:"body",placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),s("div",Pe,[Ue,n(j(L),{class:"drop",modelValue:t.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=i=>t.value.data_final=i),showIcon:"",showOnFocus:!1,format:M,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:T,teleport:"body",placeholder:"Selecione uma data final"},null,8,["modelValue"])]),s("div",$e,[n(l,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:H})]),s("div",Fe,[n(l,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Y})]),s("div",Me,[n(l,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:W})])]),s("div",Ne,[n(R,{filters:b.value,"onUpdate:filters":e[8]||(e[8]=i=>b.value=i),value:m.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",onRowSelect:Q,globalFilterFields:["ProdutoNome","Quantidade","ProdutoSKU"],selectionMode:"single",tableStyle:{width:"100%"},ref_key:"dt",ref:J},{header:c(()=>[s("div",Te,[n(te,{iconPosition:"left"},{default:c(()=>[n(f,null,{default:c(()=>[Re]),_:1}),n(h,{modelValue:b.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=i=>b.value.global.value=i),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:c(()=>[K(q(w.value),1)]),default:c(()=>[n(v,{field:"ProdutoNome",sortable:"",header:"Item"}),n(v,{field:"quantidade_no_periodo",sortable:"",header:"Quantidade",class:"text-center"}),n(v,{field:"ProdutoSKU",sortable:"",header:"CA"})]),_:1},8,["filters","value"]),$.value?(S(),E(se,{key:0,class:"details-card"},{title:c(()=>[K("Detalhes do Produto")]),content:c(()=>[n(R,{value:F.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:""},{default:c(()=>[n(v,{field:"ProdutoNome",sortable:"",header:"Item"}),n(v,{field:"Data",sortable:"",header:"Data"}),n(v,{field:"Quantidade",sortable:"",header:"Quantidade"}),n(v,{field:"ProdutoSKU",sortable:"",header:"SKU"})]),_:1},8,["value"])]),_:1})):z("",!0)])])])]),I.value?(S(),E(ve,{key:0})):z("",!0),n(ne,{header:"Informação",visible:y.value,style:{width:"30vw"},modal:!0,closable:!1},{footer:c(()=>[n(l,{label:"OK",icon:"pi pi-check",onClick:e[9]||(e[9]=i=>y.value=!1)})]),default:c(()=>[s("p",null,q(A.value),1)]),_:1},8,["visible"])],64)}}};export{Qe as default};
