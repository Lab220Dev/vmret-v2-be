import{r as n,e as ae,m as te,q as le,C as se,s as oe,g as h,o as p,c as x,d as s,h as o,w as m,z as C,a as _,l as b,U as ne,t as U,y as v,i as A}from"./index-2c4d9b34.js";import{L as ie}from"./LoadingSpinner-e33360a4.js";const re={class:"grid"},ue={class:"col-12"},ce={class:"card"},de=s("h5",{class:"mt-2"},"Usuários Dispenser Machines",-1),me={class:"col-12"},ve={class:"mt-2"},he={class:"mt-5 mx-0 p-fluid grid"},pe={class:"full lg:col-12 md:col-12 sm:col-12"},fe=s("label",{for:"name"},"Nome:",-1),ye={class:"full lg:col-7 md:col-7 sm:col-12"},_e=s("label",{for:"email"},"Login:",-1),be={class:"full lg:col-5 md:col-5 sm:col-12"},ge=s("label",{for:"senha"},"Senha:",-1),we={key:0,class:"p-error"},Ue={class:"full lg:col-5 md:col-5 sm:col-12"},ke=s("label",{for:"senha"},"Confirme a Senha:",-1),Se={key:0,class:"p-error"},Ve={class:"full lg:col-4 md:col-4 sm:col-12"},De=s("label",{class:"mt-3 ml-4",for:"switch2"},"Usuario Ativo?",-1),xe={class:"flex align-items-center justify-content-end field col-12"},Ce={key:0,class:"col-12"},Me={class:"confirmation-content"},ze=s("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),Ae={class:""},Te={__name:"UsuariosDMs",setup(Be){const f=n(0),i=ae(),r=n(!1),k=te(),B={label:"Todos",value:null},d=n(!1),S=n(""),R=n(!1),I=n(""),u=n({}),g=n(!1),V=n({}),O=n([B]);let l=le({nome:"",login:"",senha:"",ativo:!0});const E=n([]),q=a=>{d.value=!0,l=a.data,S.value=l.senha,I.value=l.senha,R.value=!1,f.value=1},F=()=>{f.value=0,z()},K=()=>{W()&&(d.value?N():H())},W=()=>(u.value={},M(),Object.keys(u.value).every(a=>u.value[a]===null)),M=()=>{S.value!==l.senha?u.value.senha="A senha NÃO é a mesma":u.value.senha=null},$=n([]);n([]);const T=n([]),G=()=>l.senha===I.value,H=async()=>{let a=null;i.userRole==="Administrador"?(a={},a=l):(a={},a=l,a.id_cliente=i.userIdCliente);try{const e=await b.post("/UDM/adicionar",a,{headers:{Authorization:`Bearer ${i.token}`}});k.add({severity:"success",summary:"Successful",detail:"Usuario DM criado",life:3e3}),w(),d.value=!0}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{r.value=!1}r.value=!0},N=async()=>{r.value=!0;const a={...l};G()&&delete a.senha;try{const e=await b.post("/UDM/atualizar",a,{headers:{Authorization:`Bearer ${i.token}`}});k.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),w(),f.value=0,z()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{r.value=!1}r.value=!0},J=async()=>{const a={id_cliente:i.userIdCliente};try{const e=await b.post("/plantas/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});O.value=[B,...e.data.map(({id_planta:c})=>({label:`Planta  ${c}`,value:c}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},w=async()=>{r.value=!0;let a=null;i.userRole==="Administrador"?a="":(a={},a.id_cliente=i.userIdCliente);try{const e=await b.post("/UDM/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});E.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{r.value=!1}},Q=async()=>{r.value=!0;let a=null;i.userRole==="Administrador"?a="":(a={},a.id_cliente=i.userIdCliente);try{const e=await b.post("/DM/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});T.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{r.value=!1}};se(f,(a,e)=>{a!==e&&a===0&&(z(),w(),d.value=!1)}),oe(()=>{J(),w(),Q()});const j=a=>{V.value=a,g.value=!0},X=async a=>{r.value=!0;let e={id:a.id};try{await b.post("/UDM/deletar",e,{headers:{Authorization:`Bearer ${i.token}`}}),k.add({severity:"success",summary:"Successful",detail:"Ciente Deletada",life:3e3}),g.value=!1,w(),f.value=0}catch{k.add({severity:"error",summary:"Error",detail:"Erro ao deletar a planta.",life:3e3})}finally{r.value=!1}},z=()=>{l.nome="",l.Status=!0,l.email="",l.perfil="",l.planta="",l.senha=""};return(a,e)=>{const c=h("Column"),y=h("Button"),L=h("DataTable"),P=h("TabPanel"),D=h("InputText"),Y=h("InputSwitch"),Z=h("TabView"),ee=h("Dialog");return p(),x("div",re,[s("div",ue,[s("div",ce,[de,o(Z,{activeIndex:f.value,"onUpdate:activeIndex":e[8]||(e[8]=t=>f.value=t)},{default:m(()=>[o(P,{header:"Listar  Usuário DM"},{default:m(()=>[s("div",me,[o(L,{value:E.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:q,paginator:"",rows:10},{default:m(()=>[o(c,{field:"nome",header:"Nome"}),o(c,{field:"login",header:"Login"}),o(c,{field:"ativo",header:"Ativo"},{body:m(({data:t})=>[s("i",{class:ne(["pi",{"pi-check-circle text-green-500 ":t.ativo,"pi-times-circle text-red-500":!t.ativo}])},null,2)]),_:1}),o(c,{style:{"min-width":"8rem"}},{body:m(t=>[o(y,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:Ie=>j(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1}),o(P,{header:"Adicionar Usuário DM"},{default:m(()=>[s("h5",ve,U(d.value?"Editar ":"Novo ")+"Usuário",1),s("div",he,[s("div",pe,[fe,o(D,{class:"my-2",modelValue:v(l).nome,"onUpdate:modelValue":e[0]||(e[0]=t=>v(l).nome=t),id:"name",type:"text"},null,8,["modelValue"])]),s("div",ye,[_e,o(D,{class:"my-2",modelValue:v(l).login,"onUpdate:modelValue":e[1]||(e[1]=t=>v(l).login=t),id:"email"},null,8,["modelValue"])]),s("div",be,[ge,o(D,{class:"my-2",id:"senha",modelValue:v(l).senha,"onUpdate:modelValue":e[2]||(e[2]=t=>v(l).senha=t),type:"password",invalid:!!u.value.senha,onBlur:M},null,8,["modelValue","invalid"]),u.value.senha?(p(),x("small",we,U(u.value.senha),1)):_("",!0)]),s("div",Ue,[ke,o(D,{class:"my-2",id:"senha",modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=t=>S.value=t),type:"password",invalid:!!u.value.senha,onBlur:M},null,8,["modelValue","invalid"]),u.value.senha?(p(),x("small",Se,U(u.value.senha),1)):_("",!0)]),s("div",Ve,[De,o(Y,{class:"grid mt-3 ml-3",modelValue:v(l).ativo,"onUpdate:modelValue":e[4]||(e[4]=t=>v(l).ativo=t),inputId:"switch2"},null,8,["modelValue"])]),s("div",xe,[d.value?(p(),C(y,{key:0,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Atualizar",icon:"pi pi-refresh",severity:"primary",onClick:N})):_("",!0),d.value?(p(),C(y,{key:1,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Excluir",icon:"pi pi-trash",severity:"danger",onClick:e[5]||(e[5]=t=>j(v(l)))})):_("",!0),o(y,{style:{width:"15%"},class:"flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-arrow-left",severity:"primary",onClick:e[6]||(e[6]=t=>F())}),d.value?_("",!0):(p(),C(y,{key:2,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"info",onClick:K}))])]),d.value?(p(),x("div",Ce,[o(L,{selection:$.value,"onUpdate:selection":e[7]||(e[7]=t=>$.value=t),value:T.value,dataKey:"code",tableStyle:"width:100% min-width: 50rem",size:a.small},{default:m(()=>[o(c,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(c,{field:"ID_DM",header:"Id Maquina",class:"col-12 md:col-6",style:{width:"30%"}}),o(c,{field:"Identificacao",header:"Nome",class:"col-12 md:col-6",style:{width:"70%"}})]),_:1},8,["selection","value","size"])])):_("",!0)]),_:1})]),_:1},8,["activeIndex"]),o(ee,{header:"Deletar Usuario",visible:g.value,"onUpdate:visible":e[11]||(e[11]=t=>g.value=t),style:{width:"400px"},modal:!0,closable:!1},{footer:m(()=>[o(y,{label:"Não",icon:"pi pi-times",onClick:e[9]||(e[9]=t=>g.value=!1),class:"p-button-text"}),o(y,{label:"Sim",icon:"pi pi-check",onClick:e[10]||(e[10]=t=>X(V.value)),class:"p-button-text"})]),default:m(()=>[s("div",Me,[ze,s("span",Ae,[A(" Você tem certeza que deseja deletar o Usuario "),s("b",null,U(V.value.id_cliente),1),A(" - "),s("b",null,U(V.value.nome),1),A(" ?")])])]),_:1},8,["visible"]),r.value?(p(),C(ie,{key:0})):_("",!0)])])])}}};export{Te as default};
