import{r,e as re,m as ue,q as de,C as ce,s as me,g as v,o as f,c as C,d as t,h as s,w as c,z as B,a as _,l as V,S as ve,i as E,t as g,y as u,A as pe}from"./index-ac32e295.js";import{L as fe}from"./LoadingSpinner-d16fdc18.js";const he={class:"grid"},_e={class:"col-12"},ye={class:"card"},be=t("h5",{class:"mt-2"},"Usuário Web",-1),ge={class:"col-12"},we={class:"flex justify-content-end"},Ve=t("i",{class:"pi pi-search"},null,-1),Se={class:"mt-2"},Ue={class:"mt-5 mx-0 p-fluid grid"},ke={class:"full lg:col-12 md:col-12 sm:col-12"},Ce=t("label",{for:"name"},"Nome:",-1),xe={class:"full lg:col-7 md:col-7 sm:col-12"},Ae=t("label",{for:"email"},"E-mail:",-1),Ie={key:0,class:"p-error"},Be={class:"full lg:col-5 md:col-5 sm:col-12"},Ee=t("label",{for:"senha"},"Senha:",-1),$e={key:0,class:"p-error"},De={class:"full lg:col-5 md:col-5 sm:col-12"},ze=t("label",{for:"senha"},"Confirme a Senha:",-1),Te={key:0,class:"p-error"},Ne={class:"full lg:col-4 md:col-4 sm:col-12"},Pe=t("label",{for:"perfil"},"Perfil:",-1),Le={key:0,class:"full lg:col-4 md:col-4 sm:col-12"},Fe=t("label",{for:"perfil"},"Cliente:",-1),Me={class:"full lg:col-4 md:col-4 sm:col-12"},Oe=t("label",{for:"planta"},"Planta:",-1),je={class:"full lg:col-4 md:col-4 sm:col-12"},We=t("label",{class:"mt-3 ml-4",for:"switch2"},"Usuario Ativo?",-1),Re={class:"flex align-items-center justify-content-end field col-12"},qe={class:"confirmation-content"},Ge=t("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),Ke={class:""},Xe={__name:"web",setup(He){const y=r(0),m=re(),d=r(!1),P=ue(),L={label:"Todos",value:null},w=r(!1),S=r(""),F=r(!1),M=r(""),O=r([L]),$=r(!1),x=r({}),n=r({}),j=r([]);let o=de({nome:"",email:"",role:"",planta:"",senha:"",ativo:!0});const W=r([]),K=r([{label:"Gestor",value:"Gestor"},{label:"Master",value:"Master"},{label:"Operador",value:"Operador"},{label:"Liberação Avulsa",value:"Avulso"}]),A=r({global:{value:null,matchMode:pe.CONTAINS}}),U=r(!1),H=l=>{w.value=!0,o=l.data,S.value=o.senha,M.value=o.senha,F.value=!1,y.value=1},R=()=>{const l=o.email;!l||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?n.value.email="E-mail inválido":n.value.email=null},D=()=>{S.value!==o.senha?n.value.senha="A senha NÃO é a mesma":n.value.senha=null},Y=()=>o.senha===M.value,J=()=>(n.value={},D(),R(),Object.keys(n.value).every(l=>n.value[l]===null)),Q=l=>{x.value=l,U.value=!0},X=async l=>{d.value=!0;let e={id_usuario:l.id_usuario};try{(await V.post("/usuarios/deletar",e,{headers:{Authorization:`Bearer ${m.token}`}})).status===200&&(U.value=!1,k())}catch(i){console.error("Erro ao carregar usuários:",i)}finally{d.value=!1}},Z=()=>{y.value=0,I()},q=()=>{J()&&(w.value?le():ee()),console.log("o validate te fodeu otario")},ee=async()=>{let l=null;m.userRole==="Administrador"?(l={},l=o):(l={},l=o,l.id_cliente=m.userIdCliente);try{const e=await V.post("/usuarios/adicionar",l,{headers:{Authorization:`Bearer ${m.token}`}});P.add({severity:"success",summary:"Successful",detail:"Usuario WEB criado",life:3e3}),k(),y.value=0,I()}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{d.value=!1}d.value=!0},le=async()=>{d.value=!0;const l={...o};Y()&&delete l.senha;try{const e=await V.post("/usuarios/atualizar",l,{headers:{Authorization:`Bearer ${m.token}`}});P.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),k(),y.value=0,I()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{d.value=!1}d.value=!0},ae=async()=>{const l={id_cliente:m.userIdCliente};try{const e=await V.post("/usuarios/listarPlanta",l,{headers:{Authorization:`Bearer ${m.token}`}});O.value=[L,...e.data.map(({id_planta:i})=>({label:`Planta  ${i}`,value:i}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},k=async()=>{d.value=!0;let l=null;m.userRole==="Administrador"?(l="",$.value=!0,te()):(l={},l.id_cliente=m.userIdCliente);try{const e=await V.post("/usuarios/listar",l,{headers:{Authorization:`Bearer ${m.token}`}});W.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{d.value=!1}},te=async()=>{d.value=!0;try{const l=await V.post("/admin/cliente/listar",{headers:{Authorization:`Bearer ${m.token}`}});j.value=l.data.map(({id_cliente:e,nome:i})=>({label:i,value:e}))}catch(l){console.error("Erro ao listar plantas:",l)}finally{d.value=!1}},oe=l=>{if(!l)return"";try{const e=new Date(l);if(isNaN(e))throw new Error("Data inválida");const i=new Date(e.getTime()+e.getTimezoneOffset()*6e4),b=String(i.getDate()).padStart(2,"0"),z=String(i.getMonth()+1).padStart(2,"0"),p=i.getFullYear(),h=String(i.getHours()).padStart(2,"0"),T=String(i.getMinutes()).padStart(2,"0");return`${b}/${z}/${p} ${h}:${T}`}catch(e){return console.error("Erro ao formatar data:",e),"Data inválida"}};ce(y,(l,e)=>{l!==e&&l===0&&(I(),k(),w.value=!1)}),me(()=>{ae(),k()});const I=()=>{o.nome="",o.Status=!0,o.email="",o.perfil="",o.planta="",o.senha="",S.value="",F.value=!1};return(l,e)=>{const i=v("InputIcon"),b=v("InputText"),z=v("IconField"),p=v("Column"),h=v("Button"),T=v("DataTable"),G=v("TabPanel"),N=v("Dropdown"),se=v("InputSwitch"),ne=v("TabView"),ie=v("Dialog");return f(),C("div",he,[t("div",_e,[t("div",ye,[be,s(ne,{activeIndex:y.value,"onUpdate:activeIndex":e[12]||(e[12]=a=>y.value=a)},{default:c(()=>[s(G,{header:"Listar  Usuário Web"},{default:c(()=>[t("div",ge,[s(T,{filters:A.value,"onUpdate:filters":e[1]||(e[1]=a=>A.value=a),value:W.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:H,paginator:"",rows:10,globalFilterFields:["nome","email","nome_cliente","role","last_login"]},{header:c(()=>[t("div",we,[s(z,{iconPosition:"left"},{default:c(()=>[s(i,null,{default:c(()=>[Ve]),_:1}),s(b,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value.global.value=a),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),default:c(()=>[s(p,{field:"id_usuario",header:"Id"}),s(p,{field:"nome",header:"Nome"}),s(p,{field:"email",header:"E-mail"}),$.value?(f(),B(p,{key:0,field:"nome_cliente",header:"Cliente"})):_("",!0),s(p,{field:"role",header:"role"}),s(p,{field:"ativo",header:"Ativo"},{body:c(({data:a})=>[t("i",{class:ve(["pi",{"pi-check-circle text-green-500 ":a.ativo,"pi-times-circle text-red-500":!a.ativo}])},null,2)]),_:1}),s(p,{field:"last_login",header:"Último Login"},{body:c(({data:a})=>[E(g(oe(new Date(a.last_login))),1)]),_:1}),s(p,{style:{"min-width":"8rem"}},{body:c(a=>[s(h,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:Ye=>Q(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1}),s(G,{header:"Adicionar Usuário Web"},{default:c(()=>[t("h5",Se,g(w.value?"Editar ":"Novo ")+"Usuário Web",1),t("div",Ue,[t("div",ke,[Ce,s(b,{class:"my-2",modelValue:u(o).nome,"onUpdate:modelValue":e[2]||(e[2]=a=>u(o).nome=a),id:"name",type:"text"},null,8,["modelValue"])]),t("div",xe,[Ae,s(b,{class:"my-2",modelValue:u(o).email,"onUpdate:modelValue":e[3]||(e[3]=a=>u(o).email=a),id:"email",invalid:!!n.value.email,onBlur:R},null,8,["modelValue","invalid"]),n.value.email?(f(),C("small",Ie,g(n.value.email),1)):_("",!0)]),t("div",Be,[Ee,s(b,{class:"my-2",id:"senha",modelValue:u(o).senha,"onUpdate:modelValue":e[4]||(e[4]=a=>u(o).senha=a),type:"password",invalid:!!n.value.senha,onBlur:D},null,8,["modelValue","invalid"]),n.value.senha?(f(),C("small",$e,g(n.value.senha),1)):_("",!0)]),t("div",De,[ze,s(b,{class:"my-2",id:"senha",modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=a=>S.value=a),type:"password",invalid:!!n.value.senha,onBlur:D},null,8,["modelValue","invalid"]),n.value.senha?(f(),C("small",Te,g(n.value.senha),1)):_("",!0)]),t("div",Ne,[Pe,s(N,{class:"my-2",id:"perfil",modelValue:u(o).role,"onUpdate:modelValue":e[6]||(e[6]=a=>u(o).role=a),options:K.value,optionLabel:"label",optionValue:"value",placeholder:"Escolha um"},null,8,["modelValue","options"])]),$.value?(f(),C("div",Le,[Fe,s(N,{class:"my-2",id:"perfil",modelValue:u(o).id_cliente,"onUpdate:modelValue":e[7]||(e[7]=a=>u(o).id_cliente=a),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Escolha um"},null,8,["modelValue","options"])])):_("",!0),t("div",Me,[Oe,s(N,{class:"my-2",id:"planta",modelValue:u(o).id_planta,"onUpdate:modelValue":e[8]||(e[8]=a=>u(o).id_planta=a),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos"},null,8,["modelValue","options"])]),t("div",je,[We,s(se,{class:"grid mt-3 ml-3",modelValue:u(o).ativo,"onUpdate:modelValue":e[9]||(e[9]=a=>u(o).ativo=a),inputId:"switch2"},null,8,["modelValue"])]),t("div",Re,[w.value?(f(),B(h,{key:0,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Atualizar",icon:"pi pi-refresh",severity:"primary",onClick:e[10]||(e[10]=a=>q())})):_("",!0),s(h,{style:{width:"15%"},class:"flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-arrow-left",severity:"primary",onClick:e[11]||(e[11]=a=>Z())}),w.value?_("",!0):(f(),B(h,{key:1,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"primary",onClick:q}))])])]),_:1})]),_:1},8,["activeIndex"]),s(ie,{header:"Deletar Usuario",visible:U.value,"onUpdate:visible":e[15]||(e[15]=a=>U.value=a),style:{width:"400px"},modal:!0,closable:!1},{footer:c(()=>[s(h,{label:"Não",icon:"pi pi-times",onClick:e[13]||(e[13]=a=>U.value=!1),class:"p-button-text"}),s(h,{label:"Sim",icon:"pi pi-check",onClick:e[14]||(e[14]=a=>X(x.value)),class:"p-button-text"})]),default:c(()=>[t("div",qe,[Ge,t("span",Ke,[E(" Você tem certeza que deseja deletar o Usuario "),t("b",null,g(x.value.id_cliente),1),E(" - "),t("b",null,g(x.value.nome),1),E(" ?")])])]),_:1},8,["visible"]),d.value?(f(),B(fe,{key:0})):_("",!0)])])])}}};export{Xe as default};
