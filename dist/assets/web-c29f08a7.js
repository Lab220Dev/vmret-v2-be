import{r as c,e as R,m as q,q as K,C as G,s as H,g as r,o as h,c as Y,d as o,h as l,w as u,z as _,a as y,l as U,S as J,i as S,t as k}from"./index-b8796d24.js";import{L as Q}from"./LoadingSpinner-5e082fdb.js";const X={class:"grid"},Z={class:"col-12"},ee={class:"card"},te=o("h5",{class:"mt-2"},"Usuário Web",-1),ae={class:"col-12"},oe={class:"mt-2"},le={class:"mt-5 mx-0 p-fluid grid"},se={class:"full lg:col-12 md:col-12 sm:col-12"},ne=o("label",{for:"name"},"Nome:",-1),ie={class:"full lg:col-7 md:col-7 sm:col-12"},re=o("label",{for:"email"},"E-mail:",-1),ue={class:"full lg:col-5 md:col-5 sm:col-12"},de=o("label",{for:"senha"},"Senha:",-1),ce={class:"full lg:col-5 md:col-5 sm:col-12"},me=o("label",{for:"senha"},"Confirme a Senha:",-1),pe={class:"full lg:col-4 md:col-4 sm:col-12"},ve=o("label",{for:"perfil"},"Perfil:",-1),fe={class:"full lg:col-4 md:col-4 sm:col-12"},he=o("label",{for:"planta"},"Planta:",-1),_e={class:"full lg:col-4 md:col-4 sm:col-12"},ye=o("label",{class:"mt-3 ml-4",for:"switch2"},"Usuario Ativo?",-1),be={class:"flex align-items-center justify-content-end field col-12"},ge={class:"confirmation-content"},we=o("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),Ve={class:""},De={__name:"web",setup(Ue){const p=c(0),m=R(),d=c(!1),D=q(),z={label:"Todos",value:null},v=c(!1),$=c(""),E=c([z]),T=c(!1),s=K({nome:"",email:"",perfil:"",planta:"",senha:"",Status:""}),x=c([]),A=c([{name:"Gestor",value:"gestor"},{name:"Master",value:"master"},{name:"Operador",value:"operador"},{name:"Liberação Avulsa",value:"avulsa"}]),B=t=>{show.value=!0,s.value=t.data},I=()=>{p.value=0,g()},N=()=>{v.value?L():P()},P=async()=>{const t={...s};try{const e=await U.post("/usuario/adicionar",t,{headers:{Authorization:`Bearer ${m.token}`}});D.add({severity:"success",summary:"Successful",detail:"Usuario WEB criado",life:3e3}),b(),p.value=0,g()}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{d.value=!1}d.value=!0},L=async()=>{d.value=!0;const t={...s};try{const e=await U.post("/usuario/atualizar",t,{headers:{Authorization:`Bearer ${m.token}`}});D.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),b(),p.value=0,g()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{d.value=!1}d.value=!0},j=async()=>{const t={id_cliente:m.userIdCliente};try{const e=await U.post("/usuarios/listarPlanta",t,{headers:{Authorization:`Bearer ${m.token}`}});E.value=[z,...e.data.map(({id_planta:n})=>({label:`Planta  ${n}`,value:n}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},b=async()=>{d.value=!0;let t=null;m.userRole==="Administrador"?(t="",T.value=!0):(t={},t.id_cliente=m.userIdCliente);try{const e=await U.post("/usuarios/listar",t,{headers:{Authorization:`Bearer ${m.token}`}});x.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{d.value=!1}},F=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e))throw new Error("Data inválida");const n=new Date(e.getTime()+e.getTimezoneOffset()*6e4),i=String(n.getDate()).padStart(2,"0"),C=String(n.getMonth()+1).padStart(2,"0"),w=n.getFullYear(),f=String(n.getHours()).padStart(2,"0"),V=String(n.getMinutes()).padStart(2,"0");return`${i}/${C}/${w} ${f}:${V}`}catch(e){return console.error("Erro ao formatar data:",e),"Data inválida"}};G(p,(t,e)=>{t!==e&&t===0&&(g(),b(),v.value=!1)}),H(()=>{j(),b()});const g=()=>{s.nome="",s.Status=!0,s.email="",s.perfil="",s.planta="",s.senha=""};return(t,e)=>{const n=r("Column"),i=r("Button"),C=r("DataTable"),w=r("TabPanel"),f=r("InputText"),V=r("Dropdown"),W=r("InputSwitch"),M=r("TabView"),O=r("Dialog");return h(),Y("div",X,[o("div",Z,[o("div",ee,[te,l(M,{activeIndex:p.value,"onUpdate:activeIndex":e[9]||(e[9]=a=>p.value=a)},{default:u(()=>[l(w,{header:"Listar  Usuário Web"},{default:u(()=>[o("div",ae,[l(C,{value:x.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:B,paginator:"",rows:10},{default:u(()=>[l(n,{field:"id_usuario",header:"Id"}),l(n,{field:"nome",header:"Nome"}),l(n,{field:"email",header:"E-mail"}),T.value?(h(),_(n,{key:0,field:"nome_cliente",header:"Cliente"})):y("",!0),l(n,{field:"role",header:"role"}),l(n,{field:"ativo",header:"Ativo"},{body:u(({data:a})=>[o("i",{class:J(["pi",{"pi-check-circle text-green-500 ":a.ativo,"pi-times-circle text-red-500":!a.ativo}])},null,2)]),_:1}),l(n,{field:"last_login",header:"Último Login"},{body:u(({data:a})=>[S(k(F(new Date(a.last_login))),1)]),_:1}),l(n,{style:{"min-width":"8rem"}},{body:u(a=>[l(i,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:Se=>t.deleteUsuario(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1}),l(w,{header:"Adicionar Usuário Web"},{default:u(()=>[o("h5",oe,k(v.value?"Editar ":"Novo ")+"Usuário Web",1),o("div",le,[o("div",se,[ne,l(f,{class:"my-2",modelValue:s.nome,"onUpdate:modelValue":e[0]||(e[0]=a=>s.nome=a),id:"name",type:"text"},null,8,["modelValue"])]),o("div",ie,[re,l(f,{class:"my-2",modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=a=>s.email=a),id:"email"},null,8,["modelValue"])]),o("div",ue,[de,l(f,{class:"my-2",id:"senha",modelValue:s.senha,"onUpdate:modelValue":e[2]||(e[2]=a=>s.senha=a),type:"password"},null,8,["modelValue"])]),o("div",ce,[me,l(f,{class:"my-2",id:"senha",modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=a=>$.value=a),type:"password"},null,8,["modelValue"])]),o("div",pe,[ve,l(V,{class:"my-2",id:"perfil",modelValue:s.perfil,"onUpdate:modelValue":e[4]||(e[4]=a=>s.perfil=a),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Escolha um"},null,8,["modelValue","options"])]),o("div",fe,[he,l(V,{class:"my-2",id:"planta",modelValue:s.planta,"onUpdate:modelValue":e[5]||(e[5]=a=>s.planta=a),options:E.value,optionLabel:"label",optionValue:"value",placeholder:"Todos"},null,8,["modelValue","options"])]),o("div",_e,[ye,l(W,{class:"grid mt-3 ml-3",modelValue:s.status,"onUpdate:modelValue":e[6]||(e[6]=a=>s.status=a),inputId:"switch2"},null,8,["modelValue"])]),o("div",be,[v.value?(h(),_(i,{key:0,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Atualizar",icon:"pi pi-refresh",severity:"primary",onClick:t.atualizarFuncionario},null,8,["onClick"])):y("",!0),v.value?(h(),_(i,{key:1,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Excluir",icon:"pi pi-trash",severity:"danger",onClick:e[7]||(e[7]=a=>t.deleteFuncionarioDialog=!0)})):y("",!0),l(i,{style:{width:"15%"},class:"flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-trash",severity:"primary",onClick:e[8]||(e[8]=a=>I())}),v.value?y("",!0):(h(),_(i,{key:2,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"info",onClick:N}))])])]),_:1})]),_:1},8,["activeIndex"]),l(O,{header:"Deletar Usuario",visible:t.deleteUsuarioDialog,"onUpdate:visible":e[12]||(e[12]=a=>t.deleteUsuarioDialog=a),style:{width:"400px"},modal:!0,closable:!1},{footer:u(()=>[l(i,{label:"Não",icon:"pi pi-times",onClick:e[10]||(e[10]=a=>t.deleteFuncionarioDialog=!1),class:"p-button-text"}),l(i,{label:"Sim",icon:"pi pi-check",onClick:e[11]||(e[11]=a=>t.deleteUsuario(t.item)),class:"p-button-text"})]),default:u(()=>[o("div",ge,[we,o("span",Ve,[S(" Você tem certeza que deseja deletar o Usuario "),o("b",null,k(t.item.id_cliente),1),S(" - "),o("b",null,k(t.item.nome),1),S(" ?")])])]),_:1},8,["visible"]),d.value?(h(),_(Q,{key:0})):y("",!0)])])])}}};export{De as default};
