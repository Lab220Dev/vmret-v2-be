import{r as n,e as ae,m as te,q as le,C as se,s as oe,g as p,o as h,c as D,d as t,h as o,w as v,z as C,a as _,l as b,U as ne,t as g,y as d,i as B}from"./index-40d2c570.js";import{L as ie}from"./LoadingSpinner-99c31137.js";/* empty css                                                       */const re={class:"grid"},ce={class:"col-12"},ue={class:"card"},de=t("h5",{class:"mt-2"},"Usuários Dispenser Machines",-1),me={class:"col-12"},ve={class:"mt-2"},pe={class:"mt-5 mx-0 p-fluid grid"},he={class:"full xl:col-8 lg:col-8 md:col-8 sm:col-12"},fe=t("label",{for:"name"},"Nome:",-1),ye={class:"full xl:col-4 lg:col-4 md:col-4 sm:col-12"},_e=t("label",{for:"senha"},"Senha:",-1),be={key:0,class:"p-error"},ge={class:"full xl:col-6 lg:col-6 md:col-6 sm:col-12"},we=t("label",{for:"email"},"Login:",-1),Ue={class:"full xl:col-2 flex flex-column align-items-center m-0 lg:col-2 md:col-2 sm:col-12"},xe=t("label",{class:"mt-0 text-nowrap",for:"switch2"},"Usuario Ativo?",-1),ke={class:"grid mt-3"},Se={class:"ml-2"},Ve={class:"full xl:col-4 lg:col-4 md:col-4 sm:col-12"},De=t("label",{for:"senha"},"Confirme a Senha:",-1),Ce={key:0,class:"p-error"},Me={class:"flex align-items-center justify-content-end field col-12"},ze={key:0,class:"col-12"},Be={class:"confirmation-content"},Ae=t("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),Ie={class:""},Le={__name:"UsuariosDMs",setup(Ee){const f=n(0),i=ae(),r=n(!1),x=te(),A={label:"Todos",value:null},m=n(!1),k=n(""),R=n(!1),I=n(""),c=n({}),w=n(!1),S=n({}),O=n([A]);let l=le({nome:"",login:"",senha:"",ativo:!0});const E=n([]),q=a=>{m.value=!0,l=a.data,k.value=l.senha,I.value=l.senha,R.value=!1,f.value=1},F=()=>{f.value=0,z()},K=()=>{W()&&(m.value?T():H())},W=()=>(c.value={},M(),Object.keys(c.value).every(a=>c.value[a]===null)),M=()=>{k.value!==l.senha?c.value.senha="A senha NÃO é a mesma":c.value.senha=null},$=n([]);n([]);const N=n([]),G=()=>l.senha===I.value,H=async()=>{let a=null;i.userRole==="Administrador"?(a={},a=l):(a={},a=l,a.id_cliente=i.userIdCliente);try{const e=await b.post("/UDM/adicionar",a,{headers:{Authorization:`Bearer ${i.token}`}});x.add({severity:"success",summary:"Successful",detail:"Usuario DM criado",life:3e3}),U(),m.value=!0}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{r.value=!1}r.value=!0},T=async()=>{r.value=!0;const a={...l};G()&&delete a.senha;try{const e=await b.post("/UDM/atualizar",a,{headers:{Authorization:`Bearer ${i.token}`}});x.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),U(),f.value=0,z()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{r.value=!1}r.value=!0},J=async()=>{const a={id_cliente:i.userIdCliente};try{const e=await b.post("/plantas/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});O.value=[A,...e.data.map(({id_planta:u})=>({label:`Planta  ${u}`,value:u}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},U=async()=>{r.value=!0;let a=null;i.userRole==="Administrador"?a="":(a={},a.id_cliente=i.userIdCliente);try{const e=await b.post("/UDM/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});E.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{r.value=!1}},Q=async()=>{r.value=!0;let a=null;i.userRole==="Administrador"?a="":(a={},a.id_cliente=i.userIdCliente);try{const e=await b.post("/DM/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});N.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{r.value=!1}};se(f,(a,e)=>{a!==e&&a===0&&(z(),U(),m.value=!1)}),oe(()=>{J(),U(),Q()});const j=a=>{S.value=a,w.value=!0},X=async a=>{r.value=!0;let e={id:a.id};try{await b.post("/UDM/deletar",e,{headers:{Authorization:`Bearer ${i.token}`}}),x.add({severity:"success",summary:"Successful",detail:"Ciente Deletada",life:3e3}),w.value=!1,U(),f.value=0}catch{x.add({severity:"error",summary:"Error",detail:"Erro ao deletar a planta.",life:3e3})}finally{r.value=!1}},z=()=>{l.nome="",l.Status=!0,l.email="",l.perfil="",l.planta="",l.senha=""};return(a,e)=>{const u=p("Column"),y=p("Button"),L=p("DataTable"),P=p("TabPanel"),V=p("InputText"),Y=p("InputSwitch"),Z=p("TabView"),ee=p("Dialog");return h(),D("div",re,[t("div",ce,[t("div",ue,[de,o(Z,{activeIndex:f.value,"onUpdate:activeIndex":e[8]||(e[8]=s=>f.value=s)},{default:v(()=>[o(P,{header:"Listar  Usuário DM"},{default:v(()=>[t("div",me,[o(L,{value:E.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:q,paginator:"",rows:10},{default:v(()=>[o(u,{field:"nome",header:"Nome"}),o(u,{field:"login",header:"Login"}),o(u,{field:"ativo",header:"Ativo"},{body:v(({data:s})=>[t("i",{class:ne(["pi",{"pi-check-circle text-green-500 ":s.ativo,"pi-times-circle text-red-500":!s.ativo}])},null,2)]),_:1}),o(u,{style:{"min-width":"8rem"}},{body:v(s=>[o(y,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:$e=>j(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1}),o(P,{header:"Adicionar Usuário DM"},{default:v(()=>[t("h5",ve,g(m.value?"Editar ":"Novo ")+"Usuário",1),t("div",pe,[t("div",he,[fe,o(V,{class:"my-2",modelValue:d(l).nome,"onUpdate:modelValue":e[0]||(e[0]=s=>d(l).nome=s),id:"name",type:"text"},null,8,["modelValue"])]),t("div",ye,[_e,o(V,{class:"my-2",id:"senha",modelValue:d(l).senha,"onUpdate:modelValue":e[1]||(e[1]=s=>d(l).senha=s),type:"password",invalid:!!c.value.senha,onBlur:M},null,8,["modelValue","invalid"]),c.value.senha?(h(),D("small",be,g(c.value.senha),1)):_("",!0)]),t("div",ge,[we,o(V,{class:"my-2",modelValue:d(l).login,"onUpdate:modelValue":e[2]||(e[2]=s=>d(l).login=s),id:"email"},null,8,["modelValue"])]),t("div",Ue,[xe,t("div",ke,[o(Y,{modelValue:d(l).ativo,"onUpdate:modelValue":e[3]||(e[3]=s=>d(l).ativo=s),inputId:"switch2",class:"mr-2"},null,8,["modelValue"]),t("span",Se,g(d(l).ativo?"Sim":"Não"),1)])]),t("div",Ve,[De,o(V,{class:"my-2",id:"senha",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=s=>k.value=s),type:"password",invalid:!!c.value.senha,onBlur:M},null,8,["modelValue","invalid"]),c.value.senha?(h(),D("small",Ce,g(c.value.senha),1)):_("",!0)]),t("div",Me,[m.value?(h(),C(y,{key:0,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"primary",onClick:T})):_("",!0),m.value?(h(),C(y,{key:1,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Excluir",icon:"pi pi-trash",severity:"danger",onClick:e[5]||(e[5]=s=>j(d(l)))})):_("",!0),o(y,{style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-arrow-left",severity:"primary",onClick:e[6]||(e[6]=s=>F())}),m.value?_("",!0):(h(),C(y,{key:2,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"info",onClick:K}))])]),m.value?(h(),D("div",ze,[o(L,{selection:$.value,"onUpdate:selection":e[7]||(e[7]=s=>$.value=s),value:N.value,dataKey:"code",tableStyle:"width:100% min-width: 50rem",size:a.small},{default:v(()=>[o(u,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(u,{field:"ID_DM",header:"Id Maquina",class:"col-12 md:col-6",style:{width:"30%"}}),o(u,{field:"Identificacao",header:"Nome",class:"col-12 md:col-6",style:{width:"70%"}})]),_:1},8,["selection","value","size"])])):_("",!0)]),_:1})]),_:1},8,["activeIndex"]),o(ee,{header:"Deletar Usuario",visible:w.value,"onUpdate:visible":e[11]||(e[11]=s=>w.value=s),style:{width:"400px"},modal:!0,closable:!1},{footer:v(()=>[o(y,{label:"Não",icon:"pi pi-times",onClick:e[9]||(e[9]=s=>w.value=!1),class:"p-button-text"}),o(y,{label:"Sim",icon:"pi pi-check",onClick:e[10]||(e[10]=s=>X(S.value)),class:"p-button-text"})]),default:v(()=>[t("div",Be,[Ae,t("span",Ie,[B(" Você tem certeza que deseja deletar o Usuario "),t("b",null,g(S.value.id_cliente),1),B(" - "),t("b",null,g(S.value.nome),1),B(" ?")])])]),_:1},8,["visible"]),r.value?(h(),C(ie,{key:0})):_("",!0)])])])}}};export{Le as default};
