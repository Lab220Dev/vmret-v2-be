import{H as E}from"./vue-datepicker-d4c95285.js";import{r as n,e as se,m as ne,s as re,g as u,o as h,c as N,d as a,h as s,y as P,a as M,w as p,z as R,F as ie,l as v,i as H,t as O,A as de}from"./index-a0b57296.js";/* empty css             */import{L as ce}from"./LoadingSpinner-5c64bd76.js";import"./format-7e97a1d1.js";/* empty css                                                       */const ue={class:"card vh"},pe={class:"form"},_e={class:"grid mt-3 mx-1 px-1"},ve=a("h5",{class:"my-4 text-2xl"},"Histórico de Abastecimento",-1),me={key:0,class:"p-0 m-0 p-fluid formgrid grid col-12"},fe={class:"field lg:col-4 md:col-6 sm:col-6"},he=a("label",{for:"dm"},"DM:",-1),be={class:"field lg:col-4 md:col-6 sm:col-6"},ye=a("label",{for:"planta"},"Planta:",-1),we={class:"field lg:col-4 md:col-6 sm:col-6"},Ve=a("label",{for:"perfil"},"Setor:",-1),ge={class:"field lg:col-6 md:col-6 sm:col-6"},De=a("label",{for:"perfil"},"Centro de Custo:",-1),Ie={class:"field lg:col-6 md:col-6 sm:col-6"},ke=a("label",{for:"perfil"},"Operador:",-1),Ce={class:"field lg:col-4 md:col-6 sm:col-6"},Me=a("label",{for:"perfil"},"Data Inicial:",-1),Oe={class:"field lg:col-4 md:col-6 sm:col-6"},Be=a("label",{for:"perfil"},"Data Final:",-1),Se={class:"field lg:col-4 md:col-6 sm:col-6"},$e={class:"datatable-wrapper"},xe={class:"flex justify-content-end"},Fe=a("i",{class:"pi pi-search"},null,-1),Pe={__name:"historicosabastecimento",setup(Te){const B=n(!1),Q=n(""),b=n(!1),d=se();ne();const y=n("Ainda não foi feita nenhuma busca"),w=n(null),V=n(null),g=n(null),D=n(null),I=n(null),k=n([]),c={label:"Todos",value:null},S=n(null),$=n([c]),x=n([c]),F=n([c]),T=n([c]),m=n({global:{value:null,matchMode:de.CONTAINS}}),C=n(!0),A=n([]),o=n({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_operador:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),U=l=>{const e=l.getDate(),t=l.getMonth()+1,i=l.getFullYear();return`${e}/${t}/${i}`},L=l=>l?new Date(l).toISOString():null,Y=async()=>{const l={id_cliente:d.userIdCliente,id_dm:o.value.dm===null?void 0:o.value.dm,id_planta:o.value.id_planta===null?void 0:o.value.id_planta,id_centro_custo:o.value.id_centro_custo===null?void 0:o.value.id_centro_custo,id_setor:o.value.id_setor===null?void 0:o.value.id_setor,id_funcionario:o.value.id_funcionario===null?void 0:o.value.id_funcionario,data_inicio:L(o.value.data_inicio),data_final:L(o.value.data_final),id_operador:o.value.id_operador};try{b.value=!0;const e=await v.post("",l,{headers:{Authorization:`Bearer ${d.token}`}});k.value=e.data,k.value.length===0?y.value="Nenhum dado encontrado. Por favor, verifique sua consulta.":y.value=""}catch(e){console.error("Erro ao buscar histórico:",e)}finally{b.value=!1}},j=()=>{C.value=!0,A.value={}},q=n(null),G=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await v.post("/relatorioRetiRe/listardm",l,{headers:{Authorization:`Bearer ${d.token}`}});$.value=[c,...e.data.map(({ID_DM:t,Identificacao:i})=>({label:`DM  ${i}`,value:t}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},K=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await v.post("plantas/listar",l,{headers:{Authorization:`Bearer ${d.token}`}});x.value=[c,...e.data.map(({nome:t,id_planta:i})=>({label:`Planta  ${t}`,value:i}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},J=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await v.post("Setor/listar",l,{headers:{Authorization:`Bearer ${d.token}`}});F.value=[c,...e.data.map(({id_setor:t,nome:i})=>({label:`Setor  ${i}`,value:t}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},W=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await v.post("cdc/listar",l,{headers:{Authorization:`Bearer ${d.token}`}});T.value=[c,...e.data.map(({ID_CentroCusto:t,Nome:i})=>({label:`Centro de Custo  ${i}`,value:t}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},X=async()=>{const l={id_cliente:d.userIdCliente};try{const e=await v.post("/funcionarios/listarOperarios",l,{headers:{Authorization:`Bearer ${d.token}`}});S.value=[c,...e.data.map(t=>({label:t.nome,value:t.id_operador}))]}catch(e){console.error("Erro ao carregar usuários:",e)}},Z=()=>{var l,e,t,i,f;(l=w.value)!=null&&l.overlayVisible&&w.value.hide(),(e=V.value)!=null&&e.overlayVisible&&V.value.hide(),(t=g.value)!=null&&t.overlayVisible&&g.value.hide(),(i=D.value)!=null&&i.overlayVisible&&D.value.hide(),(f=I.value)!=null&&f.overlayVisible&&I.value.hide()},z=()=>{Z()};return re(()=>{G(),K(),J(),X(),W()}),(l,e)=>{const t=u("Dropdown"),i=u("Button"),f=u("InputIcon"),ee=u("InputText"),oe=u("IconField"),_=u("Column"),ae=u("DataTable"),le=u("Card"),te=u("Dialog");return h(),N(ie,null,[a("div",ue,[a("div",pe,[a("div",_e,[ve,C.value?(h(),N("div",me,[a("div",fe,[he,s(t,{class:"drop",modelValue:o.value.dm,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.dm=r),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:w},null,8,["modelValue","options"])]),a("div",be,[ye,s(t,{class:"drop",modelValue:o.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.id_planta=r),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:V},null,8,["modelValue","options"])]),a("div",we,[Ve,s(t,{class:"drop",modelValue:o.value.id_setor,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.id_setor=r),options:F.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:g},null,8,["modelValue","options"])]),a("div",ge,[De,s(t,{class:"drop",modelValue:o.value.id_centro_custo,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.id_centro_custo=r),options:T.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:D},null,8,["modelValue","options"])]),a("div",Ie,[ke,s(t,{class:"drop",modelValue:o.value.id_operador,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.id_operador=r),options:S.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:I},null,8,["modelValue","options"])]),a("div",Ce,[Me,s(P(E),{class:"drop",modelValue:o.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=r=>o.value.data_inicio=r),showIcon:"",showOnFocus:!1,format:U,locale:"pt-BR","auto-apply":"","enable-time-picker":!1,onOpen:z,teleport:"body",placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),a("div",Oe,[Be,s(P(E),{class:"drop",modelValue:o.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=r=>o.value.data_final=r),showIcon:"",showOnFocus:!1,format:U,locale:"pt-BR","auto-apply":"","enable-time-picker":!1,onOpen:z,teleport:"body",placeholder:"Selecione uma data final"},null,8,["modelValue"])]),a("div",Se,[s(i,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:Y})])])):M("",!0),a("div",$e,[s(ae,{filters:m.value,"onUpdate:filters":e[8]||(e[8]=r=>m.value=r),value:k.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",globalFilterFields:["ID_DM","Data","operador","item","Quantidade","Mola"],tableStyle:{width:"100%"},ref_key:"dt",ref:q},{header:p(()=>[a("div",xe,[s(oe,{iconPosition:"left"},{default:p(()=>[s(f,null,{default:p(()=>[Fe]),_:1}),s(ee,{modelValue:m.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=r=>m.value.global.value=r),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:p(()=>[H(O(y.value),1)]),default:p(()=>[s(_,{field:"ID_DM",sortable:"",header:"DM"}),s(_,{field:"Data",sortable:"",header:"Data"}),s(_,{field:"operador",sortable:"",header:"Operador"}),s(_,{field:"item",sortable:"",header:"Item"}),s(_,{field:"Quantidade",sortable:"",header:"Quantidade",class:"text-center"}),s(_,{field:"Mola",sortable:"",header:"Mola"})]),_:1},8,["filters","value"])]),C.value?M("",!0):(h(),R(le,{key:1},{title:p(()=>[H(O(A.value.dm),1)]),content:p(()=>[s(i,{type:"button",label:"Voltar",icon:"pi pi-arrow-left",severity:"info",onClick:j})]),_:1}))])])]),b.value?(h(),R(ce,{key:0})):M("",!0),s(te,{header:"Informação",visible:B.value,style:{width:"50vw"},modal:!0,closable:!0},{footer:p(()=>[s(i,{label:"OK",icon:"pi pi-check",onClick:e[9]||(e[9]=r=>B.value=!1)})]),default:p(()=>[a("p",null,O(Q.value),1)]),_:1},8,["visible"])],64)}}};export{Pe as default};
