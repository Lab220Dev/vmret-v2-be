import{r,e as H,m as J,q as Q,C as X,s as Y,g as c,o as y,c as D,d as t,h as o,w as d,z as V,a as _,l as S,S as Z,t as g,y as m,i as x}from"./index-808fe755.js";import{L as ee}from"./LoadingSpinner-dd6b9365.js";const ae={class:"grid"},te={class:"col-12"},se={class:"card"},le=t("h5",{class:"mt-2"},"Usuários Dispenser Machines",-1),oe={class:"col-12"},ne={class:"mt-2"},ie={class:"mt-5 mx-0 p-fluid grid"},re={class:"full lg:col-12 md:col-12 sm:col-12"},ue=t("label",{for:"name"},"Nome:",-1),ce={class:"full lg:col-7 md:col-7 sm:col-12"},de=t("label",{for:"email"},"Login:",-1),me={class:"full lg:col-5 md:col-5 sm:col-12"},ve=t("label",{for:"senha"},"Senha:",-1),pe={key:0,class:"p-error"},he={class:"full lg:col-5 md:col-5 sm:col-12"},fe=t("label",{for:"senha"},"Confirme a Senha:",-1),ye={key:0,class:"p-error"},_e={class:"full lg:col-4 md:col-4 sm:col-12"},ge=t("label",{class:"mt-3 ml-4",for:"switch2"},"Usuario Ativo?",-1),be={class:"flex align-items-center justify-content-end field col-12"},Ue={class:"confirmation-content"},we=t("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),ke={class:""},xe={__name:"UsuariosDMs",setup(Ve){const v=r(0),i=H(),u=r(!1),B=J(),z={label:"Todos",value:null},p=r(!1),b=r(""),E=r(!1),A=r(""),n=r({}),$=r([z]);let s=Q({nome:"",login:"",senha:"",ativo:!0});const I=r([]),N=a=>{p.value=!0,s=a.data,b.value=s.senha,A.value=s.senha,E.value=!1,v.value=1},j=()=>{v.value=0,w()},L=()=>{P()&&(p.value?M():R()),console.log("o validate te fodeu otario")},P=()=>(n.value={},C(),validateEmail(),Object.keys(n.value).every(a=>n.value[a]===null)),C=()=>{b.value!==s.senha?n.value.senha="A senha NÃO é a mesma":n.value.senha=null},F=()=>s.senha===A.value,R=async()=>{let a=null;i.userRole==="Administrador"?(a={},a=s):(a={},a=s,a.id_cliente=i.userIdCliente);try{const e=await S.post("/UDM/adicionar",a,{headers:{Authorization:`Bearer ${i.token}`}});B.add({severity:"success",summary:"Successful",detail:"Usuario DM criado",life:3e3}),U(),v.value=0,w()}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{u.value=!1}u.value=!0},M=async()=>{u.value=!0;const a={...s};F()&&delete a.senha;try{const e=await S.post("/UDM/atualizar",a,{headers:{Authorization:`Bearer ${i.token}`}});B.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),U(),v.value=0,w()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{u.value=!1}u.value=!0},O=async()=>{const a={id_cliente:i.userIdCliente};try{const e=await S.post("/plantas/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});$.value=[z,...e.data.map(({id_planta:h})=>({label:`Planta  ${h}`,value:h}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},U=async()=>{u.value=!0;let a=null;i.userRole==="Administrador"?a="":(a={},a.id_cliente=i.userIdCliente);try{const e=await S.post("/UDM/listar",a,{headers:{Authorization:`Bearer ${i.token}`}});I.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{u.value=!1}};X(v,(a,e)=>{a!==e&&a===0&&(w(),U(),p.value=!1)}),Y(()=>{O(),U()});const w=()=>{s.nome="",s.Status=!0,s.email="",s.perfil="",s.planta="",s.senha=""};return(a,e)=>{const h=c("Column"),f=c("Button"),q=c("DataTable"),T=c("TabPanel"),k=c("InputText"),K=c("InputSwitch"),W=c("TabView"),G=c("Dialog");return y(),D("div",ae,[t("div",te,[t("div",se,[le,o(W,{activeIndex:v.value,"onUpdate:activeIndex":e[7]||(e[7]=l=>v.value=l)},{default:d(()=>[o(T,{header:"Listar  Usuário DM"},{default:d(()=>[t("div",oe,[o(q,{value:I.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:N,paginator:"",rows:10},{default:d(()=>[o(h,{field:"nome",header:"Nome"}),o(h,{field:"login",header:"Login"}),o(h,{field:"ativo",header:"Ativo"},{body:d(({data:l})=>[t("i",{class:Z(["pi",{"pi-check-circle text-green-500 ":l.ativo,"pi-times-circle text-red-500":!l.ativo}])},null,2)]),_:1}),o(h,{style:{"min-width":"8rem"}},{body:d(l=>[o(f,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:Se=>a.deleteUsuario(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1}),o(T,{header:"Adicionar Usuário DM"},{default:d(()=>[t("h5",ne,g(p.value?"Editar ":"Novo ")+"Usuário",1),t("div",ie,[t("div",re,[ue,o(k,{class:"my-2",modelValue:m(s).nome,"onUpdate:modelValue":e[0]||(e[0]=l=>m(s).nome=l),id:"name",type:"text"},null,8,["modelValue"])]),t("div",ce,[de,o(k,{class:"my-2",modelValue:m(s).login,"onUpdate:modelValue":e[1]||(e[1]=l=>m(s).login=l),id:"email"},null,8,["modelValue"])]),t("div",me,[ve,o(k,{class:"my-2",id:"senha",modelValue:m(s).senha,"onUpdate:modelValue":e[2]||(e[2]=l=>m(s).senha=l),type:"password",invalid:!!n.value.senha,onBlur:C},null,8,["modelValue","invalid"]),n.value.senha?(y(),D("small",pe,g(n.value.senha),1)):_("",!0)]),t("div",he,[fe,o(k,{class:"my-2",id:"senha",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),type:"password",invalid:!!n.value.senha,onBlur:C},null,8,["modelValue","invalid"]),n.value.senha?(y(),D("small",ye,g(n.value.senha),1)):_("",!0)]),t("div",_e,[ge,o(K,{class:"grid mt-3 ml-3",modelValue:m(s).ativo,"onUpdate:modelValue":e[4]||(e[4]=l=>m(s).ativo=l),inputId:"switch2"},null,8,["modelValue"])]),t("div",be,[p.value?(y(),V(f,{key:0,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Atualizar",icon:"pi pi-refresh",severity:"primary",onClick:M})):_("",!0),p.value?(y(),V(f,{key:1,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Excluir",icon:"pi pi-trash",severity:"danger",onClick:e[5]||(e[5]=l=>a.deleteFuncionarioDialog=!0)})):_("",!0),o(f,{style:{width:"15%"},class:"flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-arrow-left",severity:"primary",onClick:e[6]||(e[6]=l=>j())}),p.value?_("",!0):(y(),V(f,{key:2,style:{width:"15%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"info",onClick:L}))])])]),_:1})]),_:1},8,["activeIndex"]),o(G,{header:"Deletar Usuario",visible:a.deleteUsuarioDialog,"onUpdate:visible":e[10]||(e[10]=l=>a.deleteUsuarioDialog=l),style:{width:"400px"},modal:!0,closable:!1},{footer:d(()=>[o(f,{label:"Não",icon:"pi pi-times",onClick:e[8]||(e[8]=l=>a.deleteFuncionarioDialog=!1),class:"p-button-text"}),o(f,{label:"Sim",icon:"pi pi-check",onClick:e[9]||(e[9]=l=>a.deleteUsuario(a.item)),class:"p-button-text"})]),default:d(()=>[t("div",Ue,[we,t("span",ke,[x(" Você tem certeza que deseja deletar o Usuario "),t("b",null,g(a.item.id_cliente),1),x(" - "),t("b",null,g(a.item.nome),1),x(" ?")])])]),_:1},8,["visible"]),u.value?(y(),V(ee,{key:0})):_("",!0)])])])}}};export{xe as default};
