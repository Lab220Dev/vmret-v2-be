import{H as N}from"./vue-datepicker-c509b2dc.js";import{r as t,e as re,m as ie,s as ce,g as u,o as C,c as de,d as n,h as s,y as R,w as d,z as U,a as j,F as ue,B as pe,l as _,i as E,t as T,A as me}from"./index-ff547085.js";/* empty css             */import{L as ve}from"./LoadingSpinner-a1b7e700.js";import"./format-7e97a1d1.js";const fe={class:"card vh"},_e={class:"form"},he={class:"grid mt-3 mx-1 px-1"},be=n("h5",{class:"my-4 text-2xl"},"Performace por DM",-1),ye={class:"p-0 m-0 p-fluid formgrid grid col-12"},we={class:"field lg:col-4 md:col-6 sm:col-6"},ge=n("label",{for:"dm"},"DM:",-1),De={class:"field lg:col-4 md:col-6 sm:col-6"},Ce=n("label",{for:"perfil"},"Data Inicial:",-1),Ie={class:"field lg:col-4 md:col-6 sm:col-6"},ke=n("label",{for:"perfil"},"Data Final:",-1),Ve={class:"field lg:col-12 md:col-6 sm:col-6"},Se={class:"lg:col-4 md:col-6 sm:col-6"},Ae={class:"lg:col-4 md:col-6 sm:col-6"},xe={class:"lg:col-4 md:col-6 sm:col-6"},Pe={class:"datatable-wrapper"},Oe={class:"flex justify-content-end"},Be=n("i",{class:"pi pi-search"},null,-1),je={__name:"PerformaceDM",setup(Me){const y=t(!1),I=t(""),i=re();ie();const w=t("Ainda não foi feita nenhuma busca"),g=t(null),k=t(null),V=t(null),S=t(null),A=t(null),p=t([]),m={label:"Todos",value:null},z=t(null),x=t([m]),L=t([m]),q=t([m]),H=t([m]),b=t({global:{value:null,matchMode:me.CONTAINS}}),P=t(!1),O=t([]),D=t(!1),r=t({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:new Date(new Date().getFullYear(),new Date().getMonth(),1),data_final:new Date}),B=o=>{const e=o.getDate(),a=o.getMonth()+1,l=o.getFullYear();return`${e}/${a}/${l}`},M=o=>o?new Date(o).toISOString():null,K=async()=>{const o={id_cliente:i.userIdCliente,id_dm:r.value.dm===null?void 0:r.value.dm,id_planta:r.value.id_planta===null?void 0:r.value.id_planta,id_centro_custo:r.value.id_centro_custo===null?void 0:r.value.id_centro_custo,id_setor:r.value.id_setor===null?void 0:r.value.id_setor,id_funcionario:r.value.id_funcionario===null?void 0:r.value.id_funcionario,data_inicio:M(r.value.data_inicio),data_final:M(r.value.data_final)};try{D.value=!0;const e=await _.post("relatorioItems/relatorio",o,{headers:{Authorization:`Bearer ${i.token}`}});p.value=e.data,p.value.length===0?w.value="Nenhum dado encontrado. Por favor, verifique sua consulta.":w.value="",Array.isArray(p.value)&&p.value.length===0&&(I.value="Nenhum dado encontrado. Por favor, verifique sua consulta.",y.value=!0)}catch(e){console.error("Erro ao buscar centros de custo:",e)}finally{D.value=!1}},Q=o=>{P.value=!0,O.value=o.data.Detalhes,pe(()=>{const e=document.querySelector(".details-card");e&&e.scrollIntoView({behavior:"smooth"})})},J=t(null),G=o=>{const e=Object.keys(o[0]).join(","),a=o.map(l=>Object.values(l).join(",")).join(`
`);return`${e}
${a}`},Y=()=>{if(Array.isArray(p.value)){const o=p.value.flatMap(h=>Array.isArray(h.Detalhes)?h.Detalhes:(console.warn(`Detalhes não é um array para o produto ${h.ProdutoID}`),[])),e=G(o),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),v=URL.createObjectURL(a);l.setAttribute("href",v),l.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}else console.error("retiradas.value não é um array.")},W=()=>{const o=JSON.stringify(p.value,null,2),e=new Blob([o],{type:"application/json;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(e);a.setAttribute("href",l),a.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},X=async()=>{const o={id_cliente:i.userIdCliente};try{const e=await _.post("/relatorioItems/listardm",o,{headers:{Authorization:`Bearer ${i.token}`}});x.value=[m,...e.data.map(({id_dm:a})=>({label:`DM  ${a}`,value:a}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},Z=async()=>{const o={id_cliente:i.userIdCliente};try{const e=await _.post("relatorioItems/listarPlanta",o,{headers:{Authorization:`Bearer ${i.token}`}});L.value=[m,...e.data.map(({id_planta:a})=>({label:`Planta  ${a}`,value:a}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},ee=async()=>{const o={id_cliente:i.userIdCliente};try{const e=await _.post("relatorioItems/listarSetor",o,{headers:{Authorization:`Bearer ${i.token}`}});q.value=[m,...e.data.map(({id_setor:a})=>({label:`Setor  ${a}`,value:a}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},oe=async()=>{const o={id_cliente:i.userIdCliente};try{const e=await _.post("relatorioItems/listarCdC",o,{headers:{Authorization:`Bearer ${i.token}`}});H.value=[m,...e.data.map(({id_centro_custo:a})=>({label:`Centro de Custo  ${a}`,value:a}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},ae=async()=>{const o={id_cliente:i.userIdCliente};try{const e=await _.post("/funcionarios/listar",o,{headers:{Authorization:`Bearer ${i.token}`}});z.value=e.data.map(a=>({label:a.nome,value:a.id_funcionario}))}catch(e){console.error("Erro ao carregar usuários:",e)}},te=()=>{var o,e,a,l,v;(o=g.value)!=null&&o.overlayVisible&&g.value.hide(),(e=k.value)!=null&&e.overlayVisible&&k.value.hide(),(a=V.value)!=null&&a.overlayVisible&&V.value.hide(),(l=S.value)!=null&&l.overlayVisible&&S.value.hide(),(v=A.value)!=null&&v.overlayVisible&&A.value.hide()},$=()=>{te()};return ce(()=>{X(),Z(),ee(),ae(),oe()}),(o,e)=>{const a=u("Dropdown"),l=u("Button"),v=u("InputIcon"),h=u("InputText"),le=u("IconField"),f=u("Column"),F=u("DataTable"),se=u("card"),ne=u("Dialog");return C(),de(ue,null,[n("div",fe,[n("div",_e,[n("div",he,[be,n("div",ye,[n("div",we,[ge,s(a,{class:"drop",modelValue:r.value.dm,"onUpdate:modelValue":e[0]||(e[0]=c=>r.value.dm=c),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:g},null,8,["modelValue","options"])]),n("div",De,[Ce,s(R(N),{class:"drop",modelValue:r.value.data_inicio,"onUpdate:modelValue":e[1]||(e[1]=c=>r.value.data_inicio=c),showIcon:"",showOnFocus:!1,format:B,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:$,placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),n("div",Ie,[ke,s(R(N),{class:"drop",modelValue:r.value.data_final,"onUpdate:modelValue":e[2]||(e[2]=c=>r.value.data_final=c),showIcon:"",showOnFocus:!1,format:B,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:$,placeholder:"Selecione uma data final"},null,8,["modelValue"])]),n("div",Ve,[n("div",Se,[s(l,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:K})]),n("div",Ae,[s(l,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Y})]),n("div",xe,[s(l,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:W})])])]),n("div",Pe,[s(F,{filters:b.value,"onUpdate:filters":e[4]||(e[4]=c=>b.value=c),value:p.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",onRowSelect:Q,globalFilterFields:["ProdutoNome","Quantidade","ProdutoSKU"],selectionMode:"single",tableStyle:{width:"100%"},ref_key:"dt",ref:J},{header:d(()=>[n("div",Oe,[s(le,{iconPosition:"left"},{default:d(()=>[s(v,null,{default:d(()=>[Be]),_:1}),s(h,{modelValue:b.value.global.value,"onUpdate:modelValue":e[3]||(e[3]=c=>b.value.global.value=c),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:d(()=>[E(T(w.value),1)]),default:d(()=>[s(f,{field:"ProdutoNome",sortable:"",header:"DM"}),s(f,{field:"quantidade_no_periodo",sortable:"",header:"Quantidade",class:"text-center"})]),_:1},8,["filters","value"]),P.value?(C(),U(se,{key:0,class:"details-card"},{title:d(()=>[E("Detalhes do Produto")]),content:d(()=>[s(F,{value:O.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:""},{default:d(()=>[s(f,{field:"ProdutoNome",sortable:"",header:"Item"}),s(f,{field:"Data",sortable:"",header:"Data"}),s(f,{field:"Quantidade",sortable:"",header:"Quantidade"}),s(f,{field:"ProdutoSKU",sortable:"",header:"SKU"})]),_:1},8,["value"])]),_:1})):j("",!0)])])])]),D.value?(C(),U(ve,{key:0})):j("",!0),s(ne,{header:"Informação",visible:y.value,style:{width:"30vw"},modal:!0,closable:!1},{footer:d(()=>[s(l,{label:"OK",icon:"pi pi-check",onClick:e[5]||(e[5]=c=>y.value=!1)})]),default:d(()=>[n("p",null,T(I.value),1)]),_:1},8,["visible"])],64)}}};export{je as default};
