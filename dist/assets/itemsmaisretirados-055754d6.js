import{H as N}from"./vue-datepicker-91208b52.js";import{e as ae,s as te,r as i,n as le,g as u,o as k,c as se,d as l,h as s,x as R,w as p,y as L,a as j,F as ne,A as re,l as f,i as E,z as ie}from"./index-7529c793.js";/* empty css             */import{L as de}from"./LoadingSpinner-a925bd32.js";const ce={class:"card vh"},ue={class:"form"},pe={class:"grid mt-3 mx-1 px-1"},me=l("h5",{class:"my-4 text-2xl"},"Itens mais retirados",-1),_e={class:"p-0 m-0 p-fluid formgrid grid col-12"},ve={class:"field lg:col-3 md:col-6 sm:col-6"},fe=l("label",{for:"dm"},"DM:",-1),he={class:"field lg:col-3 md:col-6 sm:col-6"},be=l("label",{for:"planta"},"Planta:",-1),ye={class:"field lg:col-3 md:col-6 sm:col-6"},we=l("label",{for:"perfil"},"Centro de Custo:",-1),Ve={class:"field lg:col-3 md:col-6 sm:col-6"},ge=l("label",{for:"perfil"},"Setor:",-1),Ce={class:"field lg:col-3 md:col-6 sm:col-6"},Ie=l("label",{for:"perfil"},"Funcionário:",-1),ke={class:"field lg:col-3 md:col-6 sm:col-6"},Se=l("label",{for:"perfil"},"Data Inicial:",-1),De={class:"field lg:col-3 md:col-6 sm:col-6"},xe=l("label",{for:"perfil"},"Data Final:",-1),Ae={class:"field lg:col-3 md:col-6 sm:col-6"},Oe={class:"field lg:col-3 md:col-6 sm:col-6"},Be={class:"field lg:col-3 md:col-6 sm:col-6"},Pe={class:"datatable-wrapper"},Ue={class:"flex justify-content-end"},Fe=l("i",{class:"pi pi-search"},null,-1),je={__name:"itemsmaisretirados",setup($e){const d=ae();te();const y=i(null),w=i(null),V=i(null),g=i(null),C=i(null),_=i([]),c={label:"Todos",value:null},S=i(null),D=i([c]),x=i([c]),A=i([c]),O=i([c]),b=i({global:{value:null,matchMode:ie.CONTAINS}}),B=i(!1),P=i([]),I=i(!1),t=i({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:"",data_final:""}),U=a=>{const e=a.getDate(),o=a.getMonth()+1,n=a.getFullYear();return`${e}/${o}/${n}`},F=a=>a?new Date(a).toISOString():null,M=async()=>{const a={id_cliente:d.userIdCliente,id_dm:t.value.dm===null?void 0:t.value.dm,id_planta:t.value.id_planta===null?void 0:t.value.id_planta,id_centro_custo:t.value.id_centro_custo===null?void 0:t.value.id_centro_custo,id_setor:t.value.id_setor===null?void 0:t.value.id_setor,id_funcionario:t.value.id_funcionario===null?void 0:t.value.id_funcionario,data_inicio:F(t.value.data_inicio),data_final:F(t.value.data_final)};try{I.value=!0;const e=await f.post("relatorioItems/relatorio",a,{headers:{Authorization:`Bearer ${d.token}`}});_.value=e.data,console.log(Array.isArray(_.value))}catch(e){console.error("Erro ao buscar centros de custo:",e)}finally{I.value=!1}},z=a=>{B.value=!0,P.value=a.data.Detalhes,re(()=>{const e=document.querySelector(".details-card");e&&e.scrollIntoView({behavior:"smooth"})})},H=i(null),K=a=>{const e=Object.keys(a[0]).join(","),o=a.map(n=>Object.values(n).join(",")).join(`
`);return`${e}
${o}`},Q=()=>{if(Array.isArray(_.value)){const a=_.value.flatMap(h=>Array.isArray(h.Detalhes)?h.Detalhes:(console.warn(`Detalhes não é um array para o produto ${h.ProdutoID}`),[])),e=K(a),o=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),v=URL.createObjectURL(o);n.setAttribute("href",v),n.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else console.error("retiradas.value não é um array.")},J=()=>{const a=JSON.stringify(_.value,null,2),e=new Blob([a],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),n=URL.createObjectURL(e);o.setAttribute("href",n),o.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},q=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await f.post("/relatorioItems/listardm",a,{headers:{Authorization:`Bearer ${d.token}`}});D.value=[c,...e.data.map(({id_dm:o})=>({label:`DM  ${o}`,value:o}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},G=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await f.post("relatorioItems/listarPlanta",a,{headers:{Authorization:`Bearer ${d.token}`}});x.value=[c,...e.data.map(({id_planta:o})=>({label:`Planta  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},Y=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await f.post("relatorioItems/listarSetor",a,{headers:{Authorization:`Bearer ${d.token}`}});A.value=[c,...e.data.map(({id_setor:o})=>({label:`Setor  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},W=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await f.post("relatorioItems/listarCdC",a,{headers:{Authorization:`Bearer ${d.token}`}});O.value=[c,...e.data.map(({id_centro_custo:o})=>({label:`Centro de Custo  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},X=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await f.post("/relatorioItems/listarFuncionario",a,{headers:{Authorization:`Bearer ${d.token}`}});S.value=e.data.map(o=>({label:o.nome,value:o.id_funcionario}))}catch(e){console.error("Erro ao carregar usuários:",e)}},Z=()=>{var a,e,o,n,v;(a=y.value)!=null&&a.overlayVisible&&y.value.hide(),(e=w.value)!=null&&e.overlayVisible&&w.value.hide(),(o=V.value)!=null&&o.overlayVisible&&V.value.hide(),(n=g.value)!=null&&n.overlayVisible&&g.value.hide(),(v=C.value)!=null&&v.overlayVisible&&C.value.hide()},$=()=>{Z()};return le(()=>{q(),G(),Y(),X(),W()}),(a,e)=>{const o=u("Dropdown"),n=u("Button"),v=u("InputIcon"),h=u("InputText"),ee=u("IconField"),m=u("Column"),T=u("DataTable"),oe=u("card");return k(),se(ne,null,[l("div",ce,[l("div",ue,[l("div",pe,[me,l("div",_e,[l("div",ve,[fe,s(o,{class:"drop",modelValue:t.value.dm,"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.dm=r),options:D.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:y},null,8,["modelValue","options"])]),l("div",he,[be,s(o,{class:"drop",modelValue:t.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.id_planta=r),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:w},null,8,["modelValue","options"])]),l("div",ye,[we,s(o,{class:"drop",modelValue:t.value.id_centro_custo,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.id_centro_custo=r),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:V},null,8,["modelValue","options"])]),l("div",Ve,[ge,s(o,{class:"drop",modelValue:t.value.id_setor,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.id_setor=r),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:g},null,8,["modelValue","options"])]),l("div",Ce,[Ie,s(o,{class:"drop",modelValue:t.value.id_funcionario,"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.id_funcionario=r),options:S.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:C},null,8,["modelValue","options"])]),l("div",ke,[Se,s(R(N),{class:"drop",modelValue:t.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=r=>t.value.data_inicio=r),showIcon:"",showOnFocus:!1,format:U,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:$,placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),l("div",De,[xe,s(R(N),{class:"drop",modelValue:t.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=r=>t.value.data_final=r),showIcon:"",showOnFocus:!1,format:U,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:$,placeholder:"Selecione uma data final"},null,8,["modelValue"])]),l("div",Ae,[s(n,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:M})]),l("div",Oe,[s(n,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Q})]),l("div",Be,[s(n,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:J})])]),l("div",Pe,[s(T,{filters:b.value,"onUpdate:filters":e[8]||(e[8]=r=>b.value=r),value:_.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",onRowSelect:z,globalFilterFields:["ProdutoNome","Quantidade","ProdutoSKU"],selectionMode:"single",tableStyle:{width:"100%"},ref_key:"dt",ref:H},{header:p(()=>[l("div",Ue,[s(ee,{iconPosition:"left"},{default:p(()=>[s(v,null,{default:p(()=>[Fe]),_:1}),s(h,{modelValue:b.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=r=>b.value.global.value=r),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:p(()=>[E(" Nenhuma retirada realizada ")]),default:p(()=>[s(m,{field:"ProdutoNome",sortable:"",header:"Item"}),s(m,{field:"quantidade_no_periodo",sortable:"",header:"Quantidade",class:"text-center"}),s(m,{field:"ProdutoSKU",sortable:"",header:"CA"})]),_:1},8,["filters","value"]),B.value?(k(),L(oe,{key:0,class:"details-card"},{title:p(()=>[E("Detalhes do Produto")]),content:p(()=>[s(T,{value:P.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:""},{default:p(()=>[s(m,{field:"ProdutoNome",sortable:"",header:"Item"}),s(m,{field:"Data",sortable:"",header:"Data"}),s(m,{field:"Quantidade",sortable:"",header:"Quantidade"}),s(m,{field:"ProdutoSKU",sortable:"",header:"SKU"})]),_:1},8,["value"])]),_:1})):j("",!0)])])])]),I.value?(k(),L(de,{key:0})):j("",!0)],64)}}};export{je as default};
