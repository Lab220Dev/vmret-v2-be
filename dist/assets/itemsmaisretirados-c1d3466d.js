import{H as T}from"./vue-datepicker-ae6ecb79.js";import{e as ae,s as le,r as i,n as te,g as u,o as k,c as se,d as t,h as s,x as S,w as p,y as L,a as j,F as ne,l as v,i as E,z as re}from"./index-1ab4de76.js";/* empty css             */import{L as ie}from"./LoadingSpinner-b57db0d7.js";const de={class:"card vh"},ce={class:"form"},ue={class:"grid mt-3 mx-1 px-1"},pe=t("h5",{class:"my-4 text-2xl"},"Itens mais retirados",-1),me={class:"p-0 m-0 p-fluid formgrid grid col-12"},_e={class:"field lg:col-3 md:col-6 sm:col-6"},fe=t("label",{for:"dm"},"DM:",-1),ve={class:"field lg:col-3 md:col-6 sm:col-6"},he=t("label",{for:"planta"},"Planta:",-1),be={class:"field lg:col-3 md:col-6 sm:col-6"},ye=t("label",{for:"perfil"},"Centro de Custo:",-1),we={class:"field lg:col-3 md:col-6 sm:col-6"},Ve=t("label",{for:"perfil"},"Setor:",-1),ge={class:"field lg:col-3 md:col-6 sm:col-6"},Ce=t("label",{for:"perfil"},"Funcionário:",-1),Ie={class:"field lg:col-3 md:col-6 sm:col-6"},ke=t("label",{for:"perfil"},"Data Inicial:",-1),Se={class:"field lg:col-3 md:col-6 sm:col-6"},De=t("label",{for:"perfil"},"Data Final:",-1),xe={class:"field lg:col-3 md:col-6 sm:col-6"},Ae={class:"field lg:col-3 md:col-6 sm:col-6"},Oe={class:"field lg:col-3 md:col-6 sm:col-6"},Be={class:"datatable-wrapper"},Pe={class:"flex justify-content-end"},Ue=t("i",{class:"pi pi-search"},null,-1),Le={__name:"itemsmaisretirados",setup(Fe){const d=ae();le();const y=i(null),w=i(null),V=i(null),g=i(null),C=i(null),_=i([]),c={label:"Todos",value:null},D=i(null),x=i([c]),A=i([c]),O=i([c]),B=i([c]),b=i({global:{value:null,matchMode:re.CONTAINS}}),P=i(!1);let U=i([]);const I=i(!1),l=i({dm:"",id_planta:"",id_centro_custo:"",id_setor:"",id_funcionario:"",data_inicio:"",data_final:""}),F=a=>{const e=a.getDate(),o=a.getMonth()+1,n=a.getFullYear();return`${e}/${o}/${n}`},$=a=>a?new Date(a).toISOString():null,M=async()=>{const a={id_cliente:d.userIdCliente,id_dm:l.value.dm===null?void 0:l.value.dm,id_planta:l.value.id_planta===null?void 0:l.value.id_planta,id_centro_custo:l.value.id_centro_custo===null?void 0:l.value.id_centro_custo,id_setor:l.value.id_setor===null?void 0:l.value.id_setor,id_funcionario:l.value.id_funcionario===null?void 0:l.value.id_funcionario,data_inicio:$(l.value.data_inicio),data_final:$(l.value.data_final)};try{I.value=!0;const e=await v.post("relatorioItems/relatorio",a,{headers:{Authorization:`Bearer ${d.token}`}});_.value=e.data,console.log(Array.isArray(_.value))}catch(e){console.error("Erro ao buscar centros de custo:",e)}finally{I.value=!1}},z=a=>{P.value=!0,U=a.data.Detalhes},H=i(null),K=a=>{const e=Object.keys(a[0]).join(","),o=a.map(n=>Object.values(n).join(",")).join(`
`);return`${e}
${o}`},Q=()=>{if(Array.isArray(_.value)){const a=_.value.flatMap(h=>Array.isArray(h.Detalhes)?h.Detalhes:(console.warn(`Detalhes não é um array para o produto ${h.ProdutoID}`),[])),e=K(a),o=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),f=URL.createObjectURL(o);n.setAttribute("href",f),n.setAttribute("download","Items_Mais_Retiradas.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else console.error("retiradas.value não é um array.")},J=()=>{const a=JSON.stringify(_.value,null,2),e=new Blob([a],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),n=URL.createObjectURL(e);o.setAttribute("href",n),o.setAttribute("download","RetiradasRealizadas.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},G=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await v.post("/relatorioItems/listardm",a,{headers:{Authorization:`Bearer ${d.token}`}});x.value=[c,...e.data.map(({id_dm:o})=>({label:`DM  ${o}`,value:o}))]}catch(e){console.error("Erro ao carregar lista de dms:",e)}},q=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await v.post("relatorioItems/listarPlanta",a,{headers:{Authorization:`Bearer ${d.token}`}});A.value=[c,...e.data.map(({id_planta:o})=>({label:`Planta  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},Y=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await v.post("relatorioItems/listarSetor",a,{headers:{Authorization:`Bearer ${d.token}`}});O.value=[c,...e.data.map(({id_setor:o})=>({label:`Setor  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar setores/diretorias:",e)}},W=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await v.post("relatorioItems/listarCdC",a,{headers:{Authorization:`Bearer ${d.token}`}});B.value=[c,...e.data.map(({id_centro_custo:o})=>({label:`Centro de Custo  ${o}`,value:o}))]}catch(e){console.error("Erro ao buscar centros de custo:",e)}},X=async()=>{const a={id_cliente:d.userIdCliente};try{const e=await v.post("/relatorioItems/listarFuncionario",a,{headers:{Authorization:`Bearer ${d.token}`}});D.value=e.data.map(o=>({label:o.nome,value:o.id_funcionario}))}catch(e){console.error("Erro ao carregar usuários:",e)}},Z=()=>{var a,e,o,n,f;(a=y.value)!=null&&a.overlayVisible&&y.value.hide(),(e=w.value)!=null&&e.overlayVisible&&w.value.hide(),(o=V.value)!=null&&o.overlayVisible&&V.value.hide(),(n=g.value)!=null&&n.overlayVisible&&g.value.hide(),(f=C.value)!=null&&f.overlayVisible&&C.value.hide()},N=()=>{Z()};return te(()=>{G(),q(),Y(),X(),W()}),(a,e)=>{const o=u("Dropdown"),n=u("Button"),f=u("InputIcon"),h=u("InputText"),ee=u("IconField"),m=u("Column"),R=u("DataTable"),oe=u("Card");return k(),se(ne,null,[t("div",de,[t("div",ce,[t("div",ue,[pe,t("div",me,[t("div",_e,[fe,s(o,{class:"drop",modelValue:l.value.dm,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.dm=r),options:x.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown1",ref:y},null,8,["modelValue","options"])]),t("div",ve,[he,s(o,{class:"drop",modelValue:l.value.id_planta,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.id_planta=r),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown2",ref:w},null,8,["modelValue","options"])]),t("div",be,[ye,s(o,{class:"drop",modelValue:l.value.id_centro_custo,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.id_centro_custo=r),options:B.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown3",ref:V},null,8,["modelValue","options"])]),t("div",we,[Ve,s(o,{class:"drop",modelValue:l.value.id_setor,"onUpdate:modelValue":e[3]||(e[3]=r=>l.value.id_setor=r),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown4",ref:g},null,8,["modelValue","options"])]),t("div",ge,[Ce,s(o,{class:"drop",modelValue:l.value.id_funcionario,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.id_funcionario=r),options:D.value,optionLabel:"label",optionValue:"value",placeholder:"Todos",ref_key:"dropdown5",ref:C},null,8,["modelValue","options"])]),t("div",Ie,[ke,s(S(T),{class:"drop",modelValue:l.value.data_inicio,"onUpdate:modelValue":e[5]||(e[5]=r=>l.value.data_inicio=r),showIcon:"",showOnFocus:!1,format:F,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker1",onOpen:N,placeholder:"Selecione uma data inicial"},null,8,["modelValue"])]),t("div",Se,[De,s(S(T),{class:"drop",modelValue:l.value.data_final,"onUpdate:modelValue":e[6]||(e[6]=r=>l.value.data_final=r),showIcon:"",showOnFocus:!1,format:F,locale:"pt-BR","enable-time-picker":!1,"auto-apply":"",ref:"datepicker2",onOpen:N,placeholder:"Selecione uma data final"},null,8,["modelValue"])]),t("div",xe,[s(n,{class:"filtrar",type:"button",label:"Filtrar Dados",icon:"pi pi-search",severity:"info",onClick:M})]),t("div",Ae,[s(n,{class:"exportar",icon:"pi pi-file",label:"Exportar CSV",onClick:Q})]),t("div",Oe,[s(n,{class:"exportar",icon:"pi pi-file",label:"Exportar JSON",onClick:J})])]),t("div",Be,[s(R,{filters:b.value,"onUpdate:filters":e[8]||(e[8]=r=>b.value=r),value:_.value,stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:"",onRowSelect:z,globalFilterFields:["ProdutoNome","Quantidade","ProdutoSKU"],selectionMode:"single",tableStyle:{width:"100%"},ref_key:"dt",ref:H},{header:p(()=>[t("div",Pe,[s(ee,{iconPosition:"left"},{default:p(()=>[s(f,null,{default:p(()=>[Ue]),_:1}),s(h,{modelValue:b.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=r=>b.value.global.value=r),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),empty:p(()=>[E(" Nenhuma retirada realizada ")]),default:p(()=>[s(m,{field:"ProdutoNome",sortable:"",header:"Item"}),s(m,{field:"quantidade_no_periodo",sortable:"",header:"Quantidade",class:"text-center"}),s(m,{field:"ProdutoSKU",sortable:"",header:"CA"})]),_:1},8,["filters","value"]),P.value?(k(),L(oe,{key:0},{title:p(()=>[E("Detalhes do Produto")]),content:p(()=>[s(R,{value:S(U),stripedRows:"",showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],rowHover:""},{default:p(()=>[s(m,{field:"ProdutoNome",sortable:"",header:"Item"}),s(m,{field:"Data",sortable:"",header:"Data"}),s(m,{field:"Quantidade",sortable:"",header:"Quantidade"}),s(m,{field:"ProdutoSKU",sortable:"",header:"SKU"})]),_:1},8,["value"])]),_:1})):j("",!0)])])])]),I.value?(k(),L(ie,{key:0})):j("",!0)],64)}}};export{Le as default};
