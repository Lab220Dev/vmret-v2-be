import{r,e as re,m as ue,q as de,C as ce,s as me,g as v,o as f,c as k,d as o,h as s,w as c,z as B,a as _,l as V,S as ve,i as E,t as y,y as u,A as pe}from"./index-808fe755.js";import{L as fe}from"./LoadingSpinner-dd6b9365.js";const he={class:"grid"},_e={class:"col-12"},ye={class:"card"},be=o("h5",{class:"mt-2"},"Usuário Web",-1),ge={class:"col-12"},we={class:"flex justify-content-end"},Ve=o("i",{class:"pi pi-search"},null,-1),xe={class:"mt-4"},Se={class:"mt-3 mx-0 p-fluid grid"},Ue={class:"full xl:col-12 lg:col-12 md:col-12 sm:col-12"},ke=o("label",{for:"name"},"Nome:",-1),Ce={class:"full xl:col-6 lg:col-6 md:col-6 sm:col-12"},Ie=o("label",{for:"email"},"E-mail:",-1),Ae={key:0,class:"p-error"},Be={class:"full xl:col-3 lg:col-3 md:col-3 sm:col-12"},Ee=o("label",{for:"senha"},"Senha:",-1),$e={key:0,class:"p-error"},De={class:"full xl:col-3 lg:col-3 md:col-3 sm:col-12"},ze=o("label",{for:"senha",class:"text-nowrap"},"Confirme a Senha:",-1),Te={key:0,class:"p-error"},Ne={key:0,class:"full xl:col-12 lg:col-12 md:col-12 sm:col-12"},Pe=o("label",{for:"perfil"},"Cliente:",-1),Le={class:"full xl:col-4 flex flex-column align-items-center m-0 lg:col-4 md:col-4 sm:col-12"},Fe=o("label",{class:"mt-0 text-nowrap",for:"switch2"},"Usuario Ativo?",-1),Me={class:"grid mt-3"},Oe={class:"ml-2"},je={class:"full xl:col-4 lg:col-4 md:col-4 sm:col-12"},We=o("label",{for:"perfil"},"Perfil:",-1),Re={class:"full xl:col-4 lg:col-4 md:col-4 sm:col-12"},qe=o("label",{for:"planta"},"Planta:",-1),Ge={class:"flex align-items-center justify-content-end field col-12 mt-7"},Ke={class:"confirmation-content"},He=o("i",{class:"pi pi-exclamation-triangle mr-1",style:{"font-size":"2rem"}},null,-1),Ye={class:""},el={__name:"web",setup(Je){const b=r(0),m=re(),d=r(!1),P=ue(),L={label:"Todos",value:null},w=r(!1),x=r(""),F=r(!1),M=r(""),O=r([L]),$=r(!1),C=r({}),n=r({}),j=r([]);let t=de({nome:"",email:"",role:"",planta:"",senha:"",ativo:!0});const W=r([]),K=r([{label:"Gestor",value:"Gestor"},{label:"Master",value:"Master"},{label:"Operador",value:"Operador"},{label:"Liberação Avulsa",value:"Avulso"}]),I=r({global:{value:null,matchMode:pe.CONTAINS}}),S=r(!1),H=l=>{w.value=!0,t=l.data,x.value=t.senha,M.value=t.senha,F.value=!1,b.value=1},R=()=>{const l=t.email;!l||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?n.value.email="E-mail inválido":n.value.email=null},D=()=>{x.value!==t.senha?n.value.senha="A senha NÃO é a mesma":n.value.senha=null},Y=()=>t.senha===M.value,J=()=>(n.value={},D(),R(),Object.keys(n.value).every(l=>n.value[l]===null)),Q=l=>{C.value=l,S.value=!0},X=async l=>{d.value=!0;let e={id_usuario:l.id_usuario};try{(await V.post("/usuarios/deletar",e,{headers:{Authorization:`Bearer ${m.token}`}})).status===200&&(S.value=!1,U())}catch(i){console.error("Erro ao carregar usuários:",i)}finally{d.value=!1}},Z=()=>{b.value=0,A()},q=()=>{J()&&(w.value?le():ee()),console.log("o validate te fodeu otario")},ee=async()=>{let l=null;m.userRole==="Administrador"?(l={},l=t):(l={},l=t,l.id_cliente=m.userIdCliente);try{const e=await V.post("/usuarios/adicionar",l,{headers:{Authorization:`Bearer ${m.token}`}});P.add({severity:"success",summary:"Successful",detail:"Usuario WEB criado",life:3e3}),U(),b.value=0,A()}catch(e){console.error("Erro ao adicionar Usuario:",e)}finally{d.value=!1}d.value=!0},le=async()=>{d.value=!0;const l={...t};Y()&&delete l.senha;try{const e=await V.post("/usuarios/atualizar",l,{headers:{Authorization:`Bearer ${m.token}`}});P.add({severity:"success",summary:"Successful",detail:"Usuario WEB atualizado",life:3e3}),U(),b.value=0,A()}catch(e){console.error("Erro ao atualizar o Usuario:",e)}finally{d.value=!1}d.value=!0},ae=async()=>{const l={id_cliente:m.userIdCliente};try{const e=await V.post("/usuarios/listarPlanta",l,{headers:{Authorization:`Bearer ${m.token}`}});O.value=[L,...e.data.map(({id_planta:i})=>({label:`Planta  ${i}`,value:i}))]}catch(e){console.error("Erro ao buscar opções de plantas:",e)}},U=async()=>{d.value=!0;let l=null;m.userRole==="Administrador"?(l="",$.value=!0,oe()):(l={},l.id_cliente=m.userIdCliente);try{const e=await V.post("/usuarios/listar",l,{headers:{Authorization:`Bearer ${m.token}`}});W.value=e.data}catch(e){console.error("Erro ao carregar usuários:",e)}finally{d.value=!1}},oe=async()=>{d.value=!0;try{const l=await V.post("/admin/cliente/listar",{headers:{Authorization:`Bearer ${m.token}`}});j.value=l.data.map(({id_cliente:e,nome:i})=>({label:i,value:e}))}catch(l){console.error("Erro ao listar plantas:",l)}finally{d.value=!1}},te=l=>{if(!l)return"";try{const e=new Date(l);if(isNaN(e))throw new Error("Data inválida");const i=new Date(e.getTime()+e.getTimezoneOffset()*6e4),g=String(i.getDate()).padStart(2,"0"),z=String(i.getMonth()+1).padStart(2,"0"),p=i.getFullYear(),h=String(i.getHours()).padStart(2,"0"),T=String(i.getMinutes()).padStart(2,"0");return`${g}/${z}/${p} ${h}:${T}`}catch(e){return console.error("Erro ao formatar data:",e),"Data inválida"}};ce(b,(l,e)=>{l!==e&&l===0&&(A(),U(),w.value=!1)}),me(()=>{ae(),U()});const A=()=>{t.nome="",t.Status=!0,t.email="",t.perfil="",t.planta="",t.senha="",x.value="",F.value=!1};return(l,e)=>{const i=v("InputIcon"),g=v("InputText"),z=v("IconField"),p=v("Column"),h=v("Button"),T=v("DataTable"),G=v("TabPanel"),N=v("Dropdown"),se=v("InputSwitch"),ne=v("TabView"),ie=v("Dialog");return f(),k("div",he,[o("div",_e,[o("div",ye,[be,s(ne,{activeIndex:b.value,"onUpdate:activeIndex":e[12]||(e[12]=a=>b.value=a)},{default:c(()=>[s(G,{header:"Listar Usuário Web"},{default:c(()=>[o("div",ge,[s(T,{filters:I.value,"onUpdate:filters":e[1]||(e[1]=a=>I.value=a),value:W.value,selectionMode:"single",tableStyle:"min-width: 25%",rowsPerPageOptions:[5,10,20,50],stripedRows:"",dataKey:"id",metaKeySelection:!1,onRowSelect:H,paginator:"",rows:10,globalFilterFields:["nome","email","nome_cliente","role","last_login"]},{header:c(()=>[o("div",we,[s(z,{iconPosition:"left"},{default:c(()=>[s(i,null,{default:c(()=>[Ve]),_:1}),s(g,{modelValue:I.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value.global.value=a),placeholder:"Busca"},null,8,["modelValue"])]),_:1})])]),default:c(()=>[s(p,{field:"id_usuario",header:"Id"}),s(p,{field:"nome",header:"Nome"}),s(p,{field:"email",header:"E-mail"}),$.value?(f(),B(p,{key:0,field:"nome_cliente",header:"Cliente"})):_("",!0),s(p,{field:"role",header:"role"}),s(p,{field:"ativo",header:"Ativo"},{body:c(({data:a})=>[o("i",{class:ve(["pi",{"pi-check-circle text-green-500 ":a.ativo,"pi-times-circle text-red-500":!a.ativo}])},null,2)]),_:1}),s(p,{field:"last_login",header:"Último Login"},{body:c(({data:a})=>[E(y(te(new Date(a.last_login))),1)]),_:1}),s(p,{style:{"min-width":"8rem"}},{body:c(a=>[s(h,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:Qe=>Q(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value"])])]),_:1}),s(G,{header:"Adicionar Usuário Web"},{default:c(()=>[o("h5",xe,y(w.value?"Editar Usuário Web":""),1),o("div",Se,[o("div",Ue,[ke,s(g,{class:"my-2",modelValue:u(t).nome,"onUpdate:modelValue":e[2]||(e[2]=a=>u(t).nome=a),id:"name",type:"text"},null,8,["modelValue"])]),o("div",Ce,[Ie,s(g,{class:"my-2",modelValue:u(t).email,"onUpdate:modelValue":e[3]||(e[3]=a=>u(t).email=a),id:"email",invalid:!!n.value.email,onBlur:R},null,8,["modelValue","invalid"]),n.value.email?(f(),k("small",Ae,y(n.value.email),1)):_("",!0)]),o("div",Be,[Ee,s(g,{class:"my-2",id:"senha",modelValue:u(t).senha,"onUpdate:modelValue":e[4]||(e[4]=a=>u(t).senha=a),type:"password",invalid:!!n.value.senha,onBlur:D},null,8,["modelValue","invalid"]),n.value.senha?(f(),k("small",$e,y(n.value.senha),1)):_("",!0)]),o("div",De,[ze,s(g,{class:"my-2",id:"senha",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a),type:"password",invalid:!!n.value.senha,onBlur:D},null,8,["modelValue","invalid"]),n.value.senha?(f(),k("small",Te,y(n.value.senha),1)):_("",!0)]),$.value?(f(),k("div",Ne,[Pe,s(N,{class:"my-2",id:"perfil",modelValue:u(t).id_cliente,"onUpdate:modelValue":e[6]||(e[6]=a=>u(t).id_cliente=a),options:j.value,optionLabel:"label",optionValue:"value",placeholder:"Escolha um"},null,8,["modelValue","options"])])):_("",!0),o("div",Le,[Fe,o("div",Me,[s(se,{modelValue:u(t).ativo,"onUpdate:modelValue":e[7]||(e[7]=a=>u(t).ativo=a),inputId:"switch2",class:"mr-2"},null,8,["modelValue"]),o("span",Oe,y(u(t).ativo?"Sim":"Não"),1)])]),o("div",je,[We,s(N,{class:"my-2",id:"perfil",modelValue:u(t).role,"onUpdate:modelValue":e[8]||(e[8]=a=>u(t).role=a),options:K.value,optionLabel:"label",optionValue:"value",placeholder:"Escolha um"},null,8,["modelValue","options"])]),o("div",Re,[qe,s(N,{class:"my-2",id:"planta",modelValue:u(t).id_planta,"onUpdate:modelValue":e[9]||(e[9]=a=>u(t).id_planta=a),options:O.value,optionLabel:"label",optionValue:"value",placeholder:"Todos"},null,8,["modelValue","options"])]),o("div",Ge,[w.value?(f(),B(h,{key:0,style:{width:"30%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-refresh",severity:"primary",onClick:e[10]||(e[10]=a=>q())})):_("",!0),s(h,{style:{width:"30%"},class:"buttons flex align-items-center justify-content-center m-2 mr-0",label:"Voltar",icon:"pi pi-arrow-left",severity:"primary",onClick:e[11]||(e[11]=a=>Z())}),w.value?_("",!0):(f(),B(h,{key:1,style:{width:"30%"},class:"buttons flex align-items-center justify-content-center m-2",label:"Salvar",icon:"pi pi-check",severity:"primary",onClick:q}))])])]),_:1})]),_:1},8,["activeIndex"]),s(ie,{header:"Deletar Usuario",visible:S.value,"onUpdate:visible":e[15]||(e[15]=a=>S.value=a),style:{width:"400px"},modal:!0,closable:!1},{footer:c(()=>[s(h,{label:"Não",icon:"pi pi-times",onClick:e[13]||(e[13]=a=>S.value=!1),class:"p-button-text"}),s(h,{label:"Sim",icon:"pi pi-check",onClick:e[14]||(e[14]=a=>X(C.value)),class:"p-button-text"})]),default:c(()=>[o("div",Ke,[He,o("span",Ye,[E(" Você tem certeza que deseja deletar o Usuario "),o("b",null,y(C.value.id_cliente),1),E(" - "),o("b",null,y(C.value.nome),1),E(" ?")])])]),_:1},8,["visible"]),d.value?(f(),B(fe,{key:0})):_("",!0)])])])}}};export{el as default};
